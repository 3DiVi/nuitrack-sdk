<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Nuitrack: nuitrack_gl_sample/src/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nuitrack.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nuitrack
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">3D Skeleton Tracking Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nuitrack_gl_sample_2src_2main_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nuitrack_gl_sample/src/main.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example with OpenGL visualization.</p>
<p>See description: <a class="el" href="ExampleDescription_page.html#nuitrack_gl_sample">Nuitrack OpenGL sample</a></p>
<p><em>nuitrack_gl_sample/src/NuitrackGLSample.h</em>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NUITRACKGLSAMPLE_H_</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define NUITRACKGLSAMPLE_H_</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;nuitrack/Nuitrack.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;Windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#ifndef ANDROID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;GL/gl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;GLES/gl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    DEPTH_SEGMENT_MODE = 0,</div>
<div class="line">    RGB_MODE = 1,</div>
<div class="line">    MODES_MAX_COUNT</div>
<div class="line">} ViewMode;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Main class of the sample</span></div>
<div class="line"><span class="keyword">class </span>NuitrackGLSample final</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    NuitrackGLSample();</div>
<div class="line">    ~NuitrackGLSample();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize sample: initialize Nuitrack, create all required modules,</span></div>
<div class="line">    <span class="comment">// register callbacks and start Nuitrack</span></div>
<div class="line">    <span class="keywordtype">void</span> init(<span class="keyword">const</span> std::string&amp; config = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Update the depth map, tracking and gesture recognition data,</span></div>
<div class="line">    <span class="comment">// then redraw the view</span></div>
<div class="line">    <span class="keywordtype">bool</span> update();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Release all sample resources</span></div>
<div class="line">    <span class="keywordtype">void</span> release();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> nextViewMode()</div>
<div class="line">    {</div>
<div class="line">        _viewMode = (ViewMode)(((uint32_t)_viewMode + 1) % _modesNumber);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="_a0"></a><a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html">tdv::nuitrack::OutputMode</a> getOutputMode()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> _outputMode;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">int</span> _width, _height;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// GL data</span></div>
<div class="line">    GLuint _textureID;</div>
<div class="line">    uint8_t* _textureBuffer;</div>
<div class="line">    GLfloat _textureCoords[8];</div>
<div class="line">    GLfloat _vertexes[8];</div>
<div class="line">    std::vector&lt;GLfloat&gt; _lines;</div>
<div class="line">    std::vector&lt;GLfloat&gt; _leftHandPointers;</div>
<div class="line">    std::vector&lt;GLfloat&gt; _rightHandPointers;</div>
<div class="line">    std::vector&lt;tdv::nuitrack::Gesture&gt; _userGestures;</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html">tdv::nuitrack::OutputMode</a> _outputMode;</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1DepthSensor.html#a4ef3c3699f81bddfa6d54ffd0b90f292">tdv::nuitrack::DepthSensor::Ptr</a> _depthSensor;</div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1ColorSensor.html#a8cd01f14d4ac28f6393a2668178badee">tdv::nuitrack::ColorSensor::Ptr</a> _colorSensor;</div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1UserTracker.html#a1f58ee486640ac425dfeb9dd7dd67584">tdv::nuitrack::UserTracker::Ptr</a> _userTracker;</div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1SkeletonTracker.html#a102927d5c1a969a7c7d559a8c8e30fe7">tdv::nuitrack::SkeletonTracker::Ptr</a> _skeletonTracker;</div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1HandTracker.html#a835aae85bbf717463aa0d0663e5c9f8c">tdv::nuitrack::HandTracker::Ptr</a> _handTracker;</div>
<div class="line">    tdv::nuitrack::GestureRecognizer::Ptr _gestureRecognizer;</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="classtdv_1_1nuitrack_1_1IssuesData.html#a44ffff6fc3dda30426e32b444b3dde96">tdv::nuitrack::IssuesData::Ptr</a> _issuesData;</div>
<div class="line">    uint64_t _onIssuesUpdateHandler;</div>
<div class="line">    </div>
<div class="line">    ViewMode _viewMode;</div>
<div class="line">    uint32_t _modesNumber;</div>
<div class="line">    <span class="keywordtype">bool</span> _isInitialized;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> onNewDepthFrame(tdv::nuitrack::DepthFrame::Ptr frame);</div>
<div class="line">    <span class="keywordtype">void</span> onNewRGBFrame(tdv::nuitrack::RGBFrame::Ptr frame);</div>
<div class="line">    <span class="keywordtype">void</span> onUserUpdate(tdv::nuitrack::UserFrame::Ptr frame);</div>
<div class="line">    <span class="keywordtype">void</span> onSkeletonUpdate(tdv::nuitrack::SkeletonData::Ptr userSkeletons);</div>
<div class="line">    <span class="keywordtype">void</span> onHandUpdate(tdv::nuitrack::HandTrackerData::Ptr handData);</div>
<div class="line">    <span class="keywordtype">void</span> onNewGesture(tdv::nuitrack::GestureData::Ptr gestureData);</div>
<div class="line">    <span class="keywordtype">void</span> onIssuesUpdate(<a class="code" href="classtdv_1_1nuitrack_1_1IssuesData.html#a44ffff6fc3dda30426e32b444b3dde96">tdv::nuitrack::IssuesData::Ptr</a> issuesData);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> drawSkeleton(<span class="keyword">const</span> std::vector&lt;tdv::nuitrack::Joint&gt;&amp; joints);</div>
<div class="line">    <span class="keywordtype">void</span> drawBone(<span class="keyword">const</span> <a name="_a1"></a><a class="code" href="structtdv_1_1nuitrack_1_1Joint.html">tdv::nuitrack::Joint</a>&amp; j1, <span class="keyword">const</span> <a class="code" href="structtdv_1_1nuitrack_1_1Joint.html">tdv::nuitrack::Joint</a>&amp; j2);</div>
<div class="line">    <span class="keywordtype">void</span> renderTexture();</div>
<div class="line">    <span class="keywordtype">void</span> renderLines();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">int</span> power2(<span class="keywordtype">int</span> n);</div>
<div class="line">    <span class="keywordtype">void</span> initTexture(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* NUITRACKGLSAMPLE_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p> <em>nuitrack_gl_sample/src/NuitrackGLSample.cpp</em>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;NuitrackGLSample.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>tdv::nuitrack;</div>
<div class="line"></div>
<div class="line">NuitrackGLSample::NuitrackGLSample() :</div>
<div class="line">    _textureID(0),</div>
<div class="line">    _textureBuffer(0),</div>
<div class="line">    _width(640),</div>
<div class="line">    _height(480),</div>
<div class="line">    _viewMode(DEPTH_SEGMENT_MODE),</div>
<div class="line">    _modesNumber(2),</div>
<div class="line">    _isInitialized(false)</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line">NuitrackGLSample::~NuitrackGLSample()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        Nuitrack::release();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a name="_a2"></a><a class="code" href="classtdv_1_1nuitrack_1_1Exception.html">Exception</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Do nothing</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::init(<span class="keyword">const</span> std::string&amp; config)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialize Nuitrack first, then create Nuitrack modules</span></div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        Nuitrack::init(config);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classtdv_1_1nuitrack_1_1Exception.html">Exception</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Can not initialize Nuitrack (ExceptionType: &quot;</span> &lt;&lt; e.<a name="a3"></a><a class="code" href="classtdv_1_1nuitrack_1_1Exception.html#a7d88126b64fd4087cd37f1b23d2742e1">type</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Create all required Nuitrack modules</span></div>
<div class="line"></div>
<div class="line">    _depthSensor = DepthSensor::create();</div>
<div class="line">    <span class="comment">// Bind to event new frame</span></div>
<div class="line">    _depthSensor-&gt;connectOnNewFrame(std::bind(&amp;NuitrackGLSample::onNewDepthFrame, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _colorSensor = ColorSensor::create();</div>
<div class="line">    <span class="comment">// Bind to event new frame</span></div>
<div class="line">    _colorSensor-&gt;connectOnNewFrame(std::bind(&amp;NuitrackGLSample::onNewRGBFrame, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _outputMode = _depthSensor-&gt;getOutputMode();</div>
<div class="line">    <a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html">OutputMode</a> colorOutputMode = _colorSensor-&gt;getOutputMode();</div>
<div class="line">    <span class="keywordflow">if</span> (colorOutputMode.<a name="a4"></a><a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html#a942157348a65fe17f49d244c951dc7d4">xres</a> &gt; _outputMode.xres)</div>
<div class="line">        _outputMode.<a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html#a942157348a65fe17f49d244c951dc7d4">xres</a> = colorOutputMode.<a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html#a942157348a65fe17f49d244c951dc7d4">xres</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (colorOutputMode.<a name="a5"></a><a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html#a83a7e28b606f7544f454be90a2e788e8">yres</a> &gt; _outputMode.yres)</div>
<div class="line">        _outputMode.yres = colorOutputMode.<a class="code" href="structtdv_1_1nuitrack_1_1OutputMode.html#a83a7e28b606f7544f454be90a2e788e8">yres</a>;</div>
<div class="line"></div>
<div class="line">    _width = _outputMode.xres;</div>
<div class="line">    _height = _outputMode.yres;</div>
<div class="line"></div>
<div class="line">    _userTracker = UserTracker::create();</div>
<div class="line">    <span class="comment">// Bind to event update user tracker</span></div>
<div class="line">    _userTracker-&gt;connectOnUpdate(std::bind(&amp;NuitrackGLSample::onUserUpdate, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _skeletonTracker = SkeletonTracker::create();</div>
<div class="line">    <span class="comment">// Bind to event update skeleton tracker</span></div>
<div class="line">    _skeletonTracker-&gt;connectOnUpdate(std::bind(&amp;NuitrackGLSample::onSkeletonUpdate, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _handTracker = HandTracker::create();</div>
<div class="line">    <span class="comment">// Bind to event update Hand tracker</span></div>
<div class="line">    _handTracker-&gt;connectOnUpdate(std::bind(&amp;NuitrackGLSample::onHandUpdate, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _gestureRecognizer = GestureRecognizer::create();</div>
<div class="line">    _gestureRecognizer-&gt;connectOnNewGestures(std::bind(&amp;NuitrackGLSample::onNewGesture, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line"></div>
<div class="line">    _onIssuesUpdateHandler = Nuitrack::connectOnIssuesUpdate(std::bind(&amp;NuitrackGLSample::onIssuesUpdate,</div>
<div class="line">                                                                      <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> NuitrackGLSample::update()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!_isInitialized)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Create texture by DepthSensor output mode</span></div>
<div class="line">        initTexture(_width, _height);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// When Nuitrack modules are created, we need to call Nuitrack::run() to start processing all modules</span></div>
<div class="line">        <span class="keywordflow">try</span></div>
<div class="line">        {</div>
<div class="line">            Nuitrack::run();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classtdv_1_1nuitrack_1_1Exception.html">Exception</a>&amp; e)</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Can not start Nuitrack (ExceptionType: &quot;</span> &lt;&lt; e.<a class="code" href="classtdv_1_1nuitrack_1_1Exception.html#a7d88126b64fd4087cd37f1b23d2742e1">type</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            release();</div>
<div class="line">            exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line">        _isInitialized = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Wait and update Nuitrack data</span></div>
<div class="line">        Nuitrack::waitUpdate(_skeletonTracker);</div>
<div class="line">        </div>
<div class="line">        renderTexture();</div>
<div class="line">        renderLines();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a name="_a6"></a><a class="code" href="classtdv_1_1nuitrack_1_1LicenseNotAcquiredException.html">LicenseNotAcquiredException</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Update failed, negative result</span></div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;LicenseNotAcquired exception (ExceptionType: &quot;</span> &lt;&lt; e.<a name="a7"></a><a class="code" href="classtdv_1_1nuitrack_1_1LicenseNotAcquiredException.html#ad2f57203bda90ba28a2d5c89b37e925c">type</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classtdv_1_1nuitrack_1_1Exception.html">Exception</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Update failed, negative result</span></div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Nuitrack update failed (ExceptionType: &quot;</span> &lt;&lt; e.<a class="code" href="classtdv_1_1nuitrack_1_1Exception.html#a7d88126b64fd4087cd37f1b23d2742e1">type</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::release()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (_onIssuesUpdateHandler)</div>
<div class="line">        Nuitrack::disconnectOnIssuesUpdate(_onIssuesUpdateHandler);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Release Nuitrack and remove all modules</span></div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        Nuitrack::release();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classtdv_1_1nuitrack_1_1Exception.html">Exception</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Nuitrack release failed (ExceptionType: &quot;</span> &lt;&lt; e.<a class="code" href="classtdv_1_1nuitrack_1_1Exception.html#a7d88126b64fd4087cd37f1b23d2742e1">type</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    _isInitialized = <span class="keyword">false</span>;</div>
<div class="line">    <span class="comment">// Free texture buffer</span></div>
<div class="line">    <span class="keywordflow">if</span> (_textureBuffer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">delete</span>[] _textureBuffer;</div>
<div class="line">        _textureBuffer = 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Copy depth frame data, received from Nuitrack, to texture to visualize</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onNewDepthFrame(DepthFrame::Ptr frame)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(_viewMode != DEPTH_SEGMENT_MODE)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    uint8_t* texturePtr = _textureBuffer;</div>
<div class="line">    <span class="keyword">const</span> uint16_t* depthPtr = frame-&gt;getData();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span> wStep = (float)_width / frame-&gt;getCols();</div>
<div class="line">    <span class="keywordtype">float</span> hStep = (float)_height / frame-&gt;getRows();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span> nextVerticalBorder = hStep;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; _height; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (i == (<span class="keywordtype">int</span>)nextVerticalBorder)</div>
<div class="line">        {</div>
<div class="line">            nextVerticalBorder += hStep;</div>
<div class="line">            depthPtr += frame-&gt;getCols();</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">int</span> col = 0;</div>
<div class="line">        <span class="keywordtype">float</span> nextHorizontalBorder = wStep;</div>
<div class="line">        uint16_t depthValue = *depthPtr &gt;&gt; 5;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; _width; ++j, texturePtr += 3)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)nextHorizontalBorder)</div>
<div class="line">            {</div>
<div class="line">                ++col;</div>
<div class="line">                nextHorizontalBorder += wStep;</div>
<div class="line">                depthValue = *(depthPtr + col) &gt;&gt; 5;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            texturePtr[0] = depthValue;</div>
<div class="line">            texturePtr[1] = depthValue;</div>
<div class="line">            texturePtr[2] = depthValue;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Copy color frame data, received from Nuitrack, to texture to visualize</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onNewRGBFrame(RGBFrame::Ptr frame)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(_viewMode != RGB_MODE)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    uint8_t* texturePtr = _textureBuffer;</div>
<div class="line">    <span class="keyword">const</span> <a name="_a8"></a><a class="code" href="structtdv_1_1nuitrack_1_1Color3.html">tdv::nuitrack::Color3</a>* colorPtr = frame-&gt;getData();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">float</span> wStep = (float)_width / frame-&gt;getCols();</div>
<div class="line">    <span class="keywordtype">float</span> hStep = (float)_height / frame-&gt;getRows();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">float</span> nextVerticalBorder = hStep;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; _height; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (i == (<span class="keywordtype">int</span>)nextVerticalBorder)</div>
<div class="line">        {</div>
<div class="line">            nextVerticalBorder += hStep;</div>
<div class="line">            colorPtr += frame-&gt;getCols();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> col = 0;</div>
<div class="line">        <span class="keywordtype">float</span> nextHorizontalBorder = wStep;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; _width; ++j, texturePtr += 3)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)nextHorizontalBorder)</div>
<div class="line">            {</div>
<div class="line">                ++col;</div>
<div class="line">                nextHorizontalBorder += wStep;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            texturePtr[0] = (colorPtr + col)-&gt;red;</div>
<div class="line">            texturePtr[1] = (colorPtr + col)-&gt;green;</div>
<div class="line">            texturePtr[2] = (colorPtr + col)-&gt;blue;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">// Colorize user segments using Nuitrack User Tracker data</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onUserUpdate(UserFrame::Ptr frame)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(_viewMode != DEPTH_SEGMENT_MODE)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_LABELS = 8;</div>
<div class="line">    <span class="keyword">static</span> uint8_t colors[MAX_LABELS][3] =</div>
<div class="line">    {</div>
<div class="line">        {0, 0, 0},</div>
<div class="line">        {0, 255, 0},</div>
<div class="line">        {0, 0, 255},</div>
<div class="line">        {255, 255, 0},</div>
<div class="line">        </div>
<div class="line">        {0, 255, 255},</div>
<div class="line">        {255, 0, 255},</div>
<div class="line">        {127, 255, 0},</div>
<div class="line">        {255, 255, 255}</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    std::vector&lt;uint8_t&gt; labelIssueState(MAX_LABELS, 0);</div>
<div class="line">    <span class="keywordflow">for</span> (uint16_t label = 0; label &lt; MAX_LABELS; ++label)</div>
<div class="line">    {</div>
<div class="line">        labelIssueState[label] = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (_issuesData)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="classtdv_1_1nuitrack_1_1FrameBorderIssue.html#a63c882c16fa2c4f7eff66bca1e3ffd06">FrameBorderIssue::Ptr</a> frameBorderIssue = _issuesData-&gt;getUserIssue&lt;<a name="_a9"></a><a class="code" href="classtdv_1_1nuitrack_1_1FrameBorderIssue.html">FrameBorderIssue</a>&gt;(label);</div>
<div class="line">            labelIssueState[label] = (frameBorderIssue != 0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    uint8_t* texturePtr = _textureBuffer;</div>
<div class="line">    <span class="keyword">const</span> uint16_t* labelPtr = frame-&gt;getData();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span> wStep = (float)_width / frame-&gt;getCols();</div>
<div class="line">    <span class="keywordtype">float</span> hStep = (float)_height / frame-&gt;getRows();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span> nextVerticalBorder = hStep;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; _height; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (i == (<span class="keywordtype">int</span>)nextVerticalBorder)</div>
<div class="line">        {</div>
<div class="line">            nextVerticalBorder += hStep;</div>
<div class="line">            labelPtr += frame-&gt;getCols();</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">int</span> col = 0;</div>
<div class="line">        <span class="keywordtype">float</span> nextHorizontalBorder = wStep;</div>
<div class="line">        uint16_t label = *labelPtr;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; _width; ++j, texturePtr += 3)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)nextHorizontalBorder)</div>
<div class="line">            {</div>
<div class="line">                ++col;</div>
<div class="line">                nextHorizontalBorder += wStep;</div>
<div class="line">                label = *(labelPtr + col);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (!label)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i)</div>
<div class="line">            {</div>
<div class="line">                texturePtr[i] = colors[label &amp; 7][i];</div>
<div class="line">                <span class="keywordflow">if</span> (labelIssueState[label])</div>
<div class="line">                    texturePtr[i] /= 2;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Prepare visualization of skeletons, received from Nuitrack</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onSkeletonUpdate(SkeletonData::Ptr userSkeletons)</div>
<div class="line">{</div>
<div class="line">    _lines.clear();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> skeletons = userSkeletons-&gt;getSkeletons();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> skeleton: skeletons)</div>
<div class="line">    {</div>
<div class="line">        drawSkeleton(skeleton.joints);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Prepare visualization of tracked hands</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onHandUpdate(HandTrackerData::Ptr handData)</div>
<div class="line">{</div>
<div class="line">    _leftHandPointers.clear();</div>
<div class="line">    _rightHandPointers.clear();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> userHands : handData-&gt;getUsersHands())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (userHands.leftHand)</div>
<div class="line">        {</div>
<div class="line">            _leftHandPointers.push_back(_width * userHands.leftHand-&gt;x);</div>
<div class="line">            _leftHandPointers.push_back(_height * userHands.leftHand-&gt;y);</div>
<div class="line">            <span class="keywordflow">if</span> (userHands.leftHand-&gt;click)</div>
<div class="line">            {</div>
<div class="line">                _leftHandPointers.push_back(_width * userHands.leftHand-&gt;x);</div>
<div class="line">                _leftHandPointers.push_back(_height * userHands.leftHand-&gt;y);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (userHands.rightHand)</div>
<div class="line">        {</div>
<div class="line">            _rightHandPointers.push_back(_width * userHands.rightHand-&gt;x);</div>
<div class="line">            _rightHandPointers.push_back(_height * userHands.rightHand-&gt;y);</div>
<div class="line">            <span class="keywordflow">if</span> (userHands.rightHand-&gt;click)</div>
<div class="line">            {</div>
<div class="line">                _rightHandPointers.push_back(_width * userHands.rightHand-&gt;x);</div>
<div class="line">                _rightHandPointers.push_back(_height * userHands.rightHand-&gt;y);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Display information about gestures in the console</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onNewGesture(GestureData::Ptr gestureData)</div>
<div class="line">{</div>
<div class="line">    _userGestures = gestureData-&gt;getGestures();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _userGestures.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Recognized %d from %d\n&quot;</span>, _userGestures[i].type, _userGestures[i].userId);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::onIssuesUpdate(<a class="code" href="classtdv_1_1nuitrack_1_1IssuesData.html#a44ffff6fc3dda30426e32b444b3dde96">IssuesData::Ptr</a> issuesData)</div>
<div class="line">{</div>
<div class="line">    _issuesData = issuesData;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Helper function to draw a skeleton bone</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::drawBone(<span class="keyword">const</span> <a class="code" href="structtdv_1_1nuitrack_1_1Joint.html">Joint</a>&amp; j1, <span class="keyword">const</span> <a class="code" href="structtdv_1_1nuitrack_1_1Joint.html">Joint</a>&amp; j2)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Prepare line data for confident enough bones only</span></div>
<div class="line">    <span class="keywordflow">if</span> (j1.<a name="a10"></a><a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#ad4d5f206c0a82d3e38d702a88adc98f1">confidence</a> &gt; 0.15 &amp;&amp; j2.<a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#ad4d5f206c0a82d3e38d702a88adc98f1">confidence</a> &gt; 0.15)</div>
<div class="line">    {</div>
<div class="line">        _lines.push_back(_width * j1.<a name="a11"></a><a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#a217d87be9e2a669be550d6433be6ac7e">proj</a>.<a name="a12"></a>x);</div>
<div class="line">        _lines.push_back(_height * j1.<a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#a217d87be9e2a669be550d6433be6ac7e">proj</a>.<a name="a13"></a>y);</div>
<div class="line">        _lines.push_back(_width * j2.<a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#a217d87be9e2a669be550d6433be6ac7e">proj</a>.x);</div>
<div class="line">        _lines.push_back(_height * j2.<a class="code" href="structtdv_1_1nuitrack_1_1Joint.html#a217d87be9e2a669be550d6433be6ac7e">proj</a>.y);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Helper function to draw skeleton from Nuitrack data</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::drawSkeleton(<span class="keyword">const</span> std::vector&lt;Joint&gt;&amp; joints)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// We need to draw a bone for every pair of neighbour joints</span></div>
<div class="line">    drawBone(joints[<a name="a14"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aac704a56b38c6288d43df621f9b57c957">JOINT_HEAD</a>], joints[<a name="a15"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa351c6b2e2006949b379d602bb20862cf">JOINT_NECK</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa351c6b2e2006949b379d602bb20862cf">JOINT_NECK</a>], joints[<a name="a16"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aab357aaeb23ff5642e1c517eabe307eea">JOINT_LEFT_COLLAR</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aab357aaeb23ff5642e1c517eabe307eea">JOINT_LEFT_COLLAR</a>], joints[<a name="a17"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9369fbde0a13c6dae4fa7bf963fff7b7">JOINT_TORSO</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aab357aaeb23ff5642e1c517eabe307eea">JOINT_LEFT_COLLAR</a>], joints[<a name="a18"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa2c930cbb3580097033f14a4b7a3fc16d">JOINT_LEFT_SHOULDER</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aab357aaeb23ff5642e1c517eabe307eea">JOINT_LEFT_COLLAR</a>], joints[<a name="a19"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9bcbff7619a9964064c0bb71da94ceff">JOINT_RIGHT_SHOULDER</a>]);</div>
<div class="line">    drawBone(joints[<a name="a20"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa0062f4f07ec4514077a1557493ad4e9b">JOINT_WAIST</a>], joints[<a name="a21"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9ee4c89d236d0fe321289a47c625e3dd">JOINT_LEFT_HIP</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa0062f4f07ec4514077a1557493ad4e9b">JOINT_WAIST</a>], joints[<a name="a22"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa0813d1ebb6020935c94cdd8e27b842b3">JOINT_RIGHT_HIP</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9369fbde0a13c6dae4fa7bf963fff7b7">JOINT_TORSO</a>], joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa0062f4f07ec4514077a1557493ad4e9b">JOINT_WAIST</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa2c930cbb3580097033f14a4b7a3fc16d">JOINT_LEFT_SHOULDER</a>], joints[<a name="a23"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa7cce536895bec9c46842331b3528bc89">JOINT_LEFT_ELBOW</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa7cce536895bec9c46842331b3528bc89">JOINT_LEFT_ELBOW</a>], joints[<a name="a24"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aac97dd5349351eaf168ffe23d6a0ed1fb">JOINT_LEFT_WRIST</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aac97dd5349351eaf168ffe23d6a0ed1fb">JOINT_LEFT_WRIST</a>], joints[<a name="a25"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa439d22713c0548917ecd34573cc35832">JOINT_LEFT_HAND</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9bcbff7619a9964064c0bb71da94ceff">JOINT_RIGHT_SHOULDER</a>], joints[<a name="a26"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aaac62d4d2e2fd0f20e9eafe119ff374eb">JOINT_RIGHT_ELBOW</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aaac62d4d2e2fd0f20e9eafe119ff374eb">JOINT_RIGHT_ELBOW</a>], joints[<a name="a27"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aaae89dc3bb24ec8448b0d89e4a7556bbd">JOINT_RIGHT_WRIST</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aaae89dc3bb24ec8448b0d89e4a7556bbd">JOINT_RIGHT_WRIST</a>], joints[<a name="a28"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aacda3fd4e17fbae94a4c42d7ab4fb8bf9">JOINT_RIGHT_HAND</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa0813d1ebb6020935c94cdd8e27b842b3">JOINT_RIGHT_HIP</a>], joints[<a name="a29"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa772acebf49effa8104e76739c731655f">JOINT_RIGHT_KNEE</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa9ee4c89d236d0fe321289a47c625e3dd">JOINT_LEFT_HIP</a>], joints[<a name="a30"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa7f76a4eae83899f298c04b43b2fae7dd">JOINT_LEFT_KNEE</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa772acebf49effa8104e76739c731655f">JOINT_RIGHT_KNEE</a>], joints[<a name="a31"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa7c4439717cc2f881c4ac8a38cc3077cb">JOINT_RIGHT_ANKLE</a>]);</div>
<div class="line">    drawBone(joints[<a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aa7f76a4eae83899f298c04b43b2fae7dd">JOINT_LEFT_KNEE</a>], joints[<a name="a32"></a><a class="code" href="group__SkeletonTracker__group.html#ggabc259a32c94594974dd3325b7c72d28aaf3c29b015a6060b4ff49bd97a4331ba4">JOINT_LEFT_ANKLE</a>]);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Render prepared background texture</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::renderTexture()</div>
<div class="line">{</div>
<div class="line">    glClearColor(1, 1, 1, 1);</div>
<div class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>
<div class="line">    </div>
<div class="line">    glEnable(GL_TEXTURE_2D);</div>
<div class="line">    glColor4f(1, 1, 1, 1);</div>
<div class="line">    </div>
<div class="line">    glBindTexture(GL_TEXTURE_2D, _textureID);</div>
<div class="line">    glTexSubImage2D(GL_TEXTURE_2D, 0, 0, 0, _width, _height, GL_RGB, GL_UNSIGNED_BYTE, _textureBuffer);</div>
<div class="line">    </div>
<div class="line">    glEnableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">    glEnableClientState(GL_TEXTURE_COORD_ARRAY);</div>
<div class="line">    </div>
<div class="line">    glVertexPointer(2, GL_FLOAT, 0, _vertexes);</div>
<div class="line">    glTexCoordPointer(2, GL_FLOAT, 0, _textureCoords);</div>
<div class="line">    </div>
<div class="line">    glDrawArrays(GL_TRIANGLE_FAN, 0, 4);</div>
<div class="line">    </div>
<div class="line">    glDisableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">    glDisableClientState(GL_TEXTURE_COORD_ARRAY);</div>
<div class="line">    </div>
<div class="line">    glDisable(GL_TEXTURE_2D);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> NuitrackGLSample::power2(<span class="keywordtype">int</span> n)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m = 2;</div>
<div class="line">    <span class="keywordflow">while</span> (m &lt; n)</div>
<div class="line">        m &lt;&lt;= 1;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> m;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Visualize bones, joints and hand positions</span></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::renderLines()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (_lines.empty())</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    glEnableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">    </div>
<div class="line">    glColor4f(1, 1, 1, 1);</div>
<div class="line">    </div>
<div class="line">    glLineWidth(6);</div>
<div class="line">    </div>
<div class="line">    glVertexPointer(2, GL_FLOAT, 0, _lines.data());</div>
<div class="line">    glDrawArrays(GL_LINES, 0, _lines.size() / 2);</div>
<div class="line">    </div>
<div class="line">    glLineWidth(1);</div>
<div class="line">    </div>
<div class="line">    glEnable(GL_POINT_SMOOTH);</div>
<div class="line">    glPointSize(16);</div>
<div class="line">    </div>
<div class="line">    glVertexPointer(2, GL_FLOAT, 0, _lines.data());</div>
<div class="line">    glDrawArrays(GL_POINTS, 0, _lines.size() / 2);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (!_leftHandPointers.empty())</div>
<div class="line">    {</div>
<div class="line">        glColor4f(1, 0, 0, 1);</div>
<div class="line">        glPointSize(16);</div>
<div class="line">        glVertexPointer(2, GL_FLOAT, 0, _leftHandPointers.data());</div>
<div class="line">        glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (_leftHandPointers.size() &gt; 2)</div>
<div class="line">        {</div>
<div class="line">            glPointSize(24);</div>
<div class="line">            glVertexPointer(2, GL_FLOAT, 0, _leftHandPointers.data() + 2);</div>
<div class="line">            glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (!_rightHandPointers.empty())</div>
<div class="line">    {</div>
<div class="line">        glColor4f(0, 0, 1, 1);</div>
<div class="line">        glPointSize(16);</div>
<div class="line">        glVertexPointer(2, GL_FLOAT, 0, _rightHandPointers.data());</div>
<div class="line">        glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line">        <span class="keywordflow">if</span> (_rightHandPointers.size() &gt; 2)</div>
<div class="line">        {</div>
<div class="line">            glPointSize(24);</div>
<div class="line">            glVertexPointer(2, GL_FLOAT, 0, _rightHandPointers.data() + 2);</div>
<div class="line">            glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    glColor4f(1, 1, 1, 1);</div>
<div class="line">    glPointSize(1);</div>
<div class="line">    glDisable(GL_POINT_SMOOTH);</div>
<div class="line">    </div>
<div class="line">    glDisableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> NuitrackGLSample::initTexture(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line">{</div>
<div class="line">    glGenTextures(1, &amp;_textureID);</div>
<div class="line">    </div>
<div class="line">    width = power2(width);</div>
<div class="line">    height = power2(height);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (_textureBuffer != 0)</div>
<div class="line">        <span class="keyword">delete</span>[] _textureBuffer;</div>
<div class="line">    </div>
<div class="line">    _textureBuffer = <span class="keyword">new</span> uint8_t[width * height * 3];</div>
<div class="line">    memset(_textureBuffer, 0, <span class="keyword">sizeof</span>(uint8_t) * width * height * 3);</div>
<div class="line">    </div>
<div class="line">    glBindTexture(GL_TEXTURE_2D, _textureID);</div>
<div class="line">    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL);</div>
<div class="line">    </div>
<div class="line">    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);</div>
<div class="line">    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Set texture coordinates [0, 1] and vertexes position</span></div>
<div class="line">    {</div>
<div class="line">        _textureCoords[0] = (float) _width / width;</div>
<div class="line">        _textureCoords[1] = (float) _height / height;</div>
<div class="line">        _textureCoords[2] = (float) _width / width;</div>
<div class="line">        _textureCoords[3] = 0.0;</div>
<div class="line">        _textureCoords[4] = 0.0;</div>
<div class="line">        _textureCoords[5] = 0.0;</div>
<div class="line">        _textureCoords[6] = 0.0;</div>
<div class="line">        _textureCoords[7] = (float) _height / height;</div>
<div class="line">        </div>
<div class="line">        _vertexes[0] = _width;</div>
<div class="line">        _vertexes[1] = _height;</div>
<div class="line">        _vertexes[2] = _width;</div>
<div class="line">        _vertexes[3] = 0.0;</div>
<div class="line">        _vertexes[4] = 0.0;</div>
<div class="line">        _vertexes[5] = 0.0;</div>
<div class="line">        _vertexes[6] = 0.0;</div>
<div class="line">        _vertexes[7] = _height;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <em>nuitrack_gl_sample/src/main.cpp</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;NuitrackGLSample.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;GL/glut.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line">NuitrackGLSample sample;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Keyboard handler</span></div>
<div class="line"><span class="keywordtype">void</span> keyboard(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> key, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (key)</div>
<div class="line">    {</div>
<div class="line">    <span class="comment">// On Esc key press</span></div>
<div class="line">    <span class="keywordflow">case</span> 27:</div>
<div class="line">    {</div>
<div class="line">        sample.release();</div>
<div class="line">        glutDestroyWindow(glutGetWindow());</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Do nothing otherwise</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> mouseClick(<span class="keywordtype">int</span> button, <span class="keywordtype">int</span> state, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(button == GLUT_LEFT_BUTTON &amp;&amp; state == GLUT_DOWN)</div>
<div class="line">    {</div>
<div class="line">        sample.nextViewMode();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Update tracking data and visualize it</span></div>
<div class="line"><span class="keywordtype">void</span> display()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Delegate this action to example&#39;s main class</span></div>
<div class="line">    <span class="keywordtype">bool</span> update = sample.update();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!update)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// End the work if update failed</span></div>
<div class="line">        sample.release();</div>
<div class="line">        glutDestroyWindow(glutGetWindow());</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Do flush and swap buffers to update viewport</span></div>
<div class="line">    glFlush();</div>
<div class="line">    glutSwapBuffers();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> idle()</div>
<div class="line">{</div>
<div class="line">    glutPostRedisplay();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> showHelpInfo()</div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Usage: nuitrack_gl_sample [path/to/nuitrack.config]\n&quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;Press Esc to close window.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    showHelpInfo();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Prepare sample to work</span></div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        sample.init();</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        sample.init(argv[1]);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">auto</span> outputMode = sample.getOutputMode();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize GLUT window</span></div>
<div class="line">    glutInit(&amp;argc, argv);</div>
<div class="line">    glutInitDisplayMode(GLUT_RGB | GLUT_DOUBLE | GLUT_DEPTH);</div>
<div class="line">    glutInitWindowSize(outputMode.xres, outputMode.yres);</div>
<div class="line">    glutCreateWindow(<span class="stringliteral">&quot;Nuitrack GL Sample (Nuitrack API)&quot;</span>);</div>
<div class="line">    <span class="comment">//glutSetCursor(GLUT_CURSOR_NONE);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Connect GLUT callbacks</span></div>
<div class="line">    glutKeyboardFunc(keyboard);</div>
<div class="line">    glutDisplayFunc(display);</div>
<div class="line">    glutIdleFunc(idle);</div>
<div class="line">    glutMouseFunc(mouseClick);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup OpenGL</span></div>
<div class="line">    glDisable(GL_DEPTH_TEST);</div>
<div class="line">    glEnable(GL_TEXTURE_2D);</div>
<div class="line"></div>
<div class="line">    glEnableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">    glDisableClientState(GL_COLOR_ARRAY);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    glOrtho(0, outputMode.xres, outputMode.yres, 0, -1.0, 1.0);</div>
<div class="line">    glMatrixMode(GL_PROJECTION);</div>
<div class="line">    glPushMatrix();</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Start main loop</span></div>
<div class="line">    glutMainLoop();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Aug 22 2019 12:41:44 for Nuitrack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
