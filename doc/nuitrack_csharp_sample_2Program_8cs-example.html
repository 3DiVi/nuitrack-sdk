<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Nuitrack: nuitrack_csharp_sample/Program.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nuitrack.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nuitrack
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">3D Skeleton Tracking Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nuitrack_csharp_sample_2Program_8cs-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nuitrack_csharp_sample/Program.cs</div>  </div>
</div><!--header-->
<div class="contents">
<p>Simple C# sample.</p>
<p>See description: <a class="el" href="ExampleDescription_page.html#nuitrack_csharp_sample">Nuitrack C# sample</a></p>
<div class="fragment"><div class="line"><span class="keyword">using</span> System;</div>
<div class="line"><span class="keyword">using</span> System.Drawing;</div>
<div class="line"><span class="keyword">using</span> System.Drawing.Imaging;</div>
<div class="line"><span class="keyword">using</span> System.Windows.Forms;</div>
<div class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> nuitrack;</div>
<div class="line"><span class="keyword">using</span> nuitrack.issues;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>nuitrack</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>Program</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">public</span> <span class="keywordtype">void</span> Main()</div>
<div class="line">        {</div>
<div class="line">            Console.CancelKeyPress += delegate {</div>
<div class="line">                Nuitrack.Release();</div>
<div class="line">                GC.Collect();</div>
<div class="line">                GC.WaitForPendingFinalizers();</div>
<div class="line">            };</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                Application.Run(<span class="keyword">new</span> MainForm());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(exception.ToString());</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>DirectBitmap : IDisposable</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> Bitmap Bitmap { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> Int32[] Bits { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">bool</span> Disposed { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">int</span> Height { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">int</span> Width { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> GCHandle BitsHandle { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> DirectBitmap(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line">        {</div>
<div class="line">            Width = width;</div>
<div class="line">            Height = height;</div>
<div class="line">            Bits = <span class="keyword">new</span> Int32[width * height];</div>
<div class="line">            BitsHandle = GCHandle.Alloc(Bits, GCHandleType.Pinned);</div>
<div class="line">            Bitmap = <span class="keyword">new</span> Bitmap(width, height, width * 4, PixelFormat.Format32bppPArgb, BitsHandle.AddrOfPinnedObject());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> SetPixel(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, Color colour)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> index = x + (y * Width);</div>
<div class="line">            <span class="keywordtype">int</span> col = colour.ToArgb();</div>
<div class="line"></div>
<div class="line">            Bits[index] = col;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> Color GetPixel(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> index = x + (y * Width);</div>
<div class="line">            <span class="keywordtype">int</span> col = Bits[index];</div>
<div class="line">            Color result = Color.FromArgb(col);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> result;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> Dispose()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (Disposed)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            Disposed = <span class="keyword">true</span>;</div>
<div class="line">            Bitmap.Dispose();</div>
<div class="line">            BitsHandle.Free();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>MainForm : Form</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">private</span> DirectBitmap _bitmap;</div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">bool</span> _visualizeColorImage = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">bool</span> _colorStreamEnabled = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> DepthSensor _depthSensor;</div>
<div class="line">        <span class="keyword">private</span> ColorSensor _colorSensor;</div>
<div class="line">        <span class="keyword">private</span> UserTracker _userTracker;</div>
<div class="line">        <span class="keyword">private</span> SkeletonTracker _skeletonTracker;</div>
<div class="line">        <span class="keyword">private</span> GestureRecognizer _gestureRecognizer;</div>
<div class="line">        <span class="keyword">private</span> HandTracker _handTracker;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> DepthFrame _depthFrame;</div>
<div class="line">        <span class="keyword">private</span> SkeletonData _skeletonData;</div>
<div class="line">        <span class="keyword">private</span> HandTrackerData _handTrackerData;</div>
<div class="line">        <span class="keyword">private</span> IssuesData _issuesData = null;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> MainForm()</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Initialize Nuitrack. This should be called before using any Nuitrack module.</span></div>
<div class="line">            <span class="comment">// By passing the default arguments we specify that Nuitrack must determine</span></div>
<div class="line">            <span class="comment">// the location automatically.</span></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                Nuitrack.Init(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Cannot initialize Nuitrack.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">throw</span> exception;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Create and setup all required modules</span></div>
<div class="line">                _depthSensor = DepthSensor.Create();</div>
<div class="line">                _colorSensor = ColorSensor.Create();</div>
<div class="line">                _userTracker = UserTracker.Create();</div>
<div class="line">                _skeletonTracker = SkeletonTracker.Create();</div>
<div class="line">                _handTracker = HandTracker.Create();</div>
<div class="line">                _gestureRecognizer = GestureRecognizer.Create();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Cannot create Nuitrack module.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">throw</span> exception;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            _depthSensor.SetMirror(<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Add event handlers for all modules</span></div>
<div class="line">            _depthSensor.OnUpdateEvent += onDepthSensorUpdate;</div>
<div class="line">            _colorSensor.OnUpdateEvent += onColorSensorUpdate;</div>
<div class="line">            _userTracker.OnUpdateEvent += onUserTrackerUpdate;</div>
<div class="line">            _skeletonTracker.OnSkeletonUpdateEvent += onSkeletonUpdate;</div>
<div class="line">            _handTracker.OnUpdateEvent += onHandTrackerUpdate;</div>
<div class="line">            _gestureRecognizer.OnNewGesturesEvent += onNewGestures;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Add an event handler for the IssueUpdate event </span></div>
<div class="line">            Nuitrack.onIssueUpdateEvent += onIssueDataUpdate;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Create and configure the Bitmap object according to the depth sensor output mode</span></div>
<div class="line">            OutputMode mode = _depthSensor.GetOutputMode();</div>
<div class="line">            OutputMode colorMode = _colorSensor.GetOutputMode();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (mode.XRes &lt; colorMode.XRes)</div>
<div class="line">                mode.XRes = colorMode.XRes;</div>
<div class="line">            <span class="keywordflow">if</span> (mode.YRes &lt; colorMode.YRes)</div>
<div class="line">                mode.YRes = colorMode.YRes;</div>
<div class="line"></div>
<div class="line">            _bitmap = <span class="keyword">new</span> DirectBitmap(mode.XRes, mode.YRes);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; mode.YRes; ++y)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; mode.XRes; ++x)</div>
<div class="line">                    _bitmap.SetPixel(x, y, Color.FromKnownColor(KnownColor.Aqua));</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Set fixed form size</span></div>
<div class="line">            this.MinimumSize = this.MaximumSize = <span class="keyword">new</span> Size(mode.XRes, mode.YRes);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Disable unnecessary caption bar buttons</span></div>
<div class="line">            this.MinimizeBox = this.MaximizeBox = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Enable double buffering to prevent flicker</span></div>
<div class="line">            this.DoubleBuffered = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Run Nuitrack. This starts sensor data processing.</span></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                Nuitrack.Run();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Cannot start Nuitrack.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">throw</span> exception;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            this.Show();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ~MainForm()</div>
<div class="line">        {</div>
<div class="line">            _bitmap.Dispose();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnFormClosing(FormClosingEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Release Nuitrack and remove all modules</span></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                Nuitrack.onIssueUpdateEvent -= onIssueDataUpdate;</div>
<div class="line"></div>
<div class="line">                _depthSensor.OnUpdateEvent -= onDepthSensorUpdate;</div>
<div class="line">                _colorSensor.OnUpdateEvent -= onColorSensorUpdate;</div>
<div class="line">                _userTracker.OnUpdateEvent -= onUserTrackerUpdate;</div>
<div class="line">                _skeletonTracker.OnSkeletonUpdateEvent -= onSkeletonUpdate;</div>
<div class="line">                _handTracker.OnUpdateEvent -= onHandTrackerUpdate;</div>
<div class="line">                _gestureRecognizer.OnNewGesturesEvent -= onNewGestures;</div>
<div class="line"></div>
<div class="line">                Nuitrack.Release();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Nuitrack release failed.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">throw</span> exception;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Switch visualization mode on a mouse click</span></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnClick(EventArgs args)</div>
<div class="line">        {</div>
<div class="line">            base.OnClick(args);</div>
<div class="line"></div>
<div class="line">            _visualizeColorImage = !_visualizeColorImage;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPaint(PaintEventArgs args)</div>
<div class="line">        {</div>
<div class="line">            base.OnPaint(args);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Update Nuitrack data. Data will be synchronized with skeleton time stamps.</span></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                Nuitrack.Update(_skeletonTracker);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(LicenseNotAcquiredException exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;LicenseNotAcquired exception. Exception: &quot;</span>, exception);</div>
<div class="line">                <span class="keywordflow">throw</span> exception;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(Exception exception)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Nuitrack update failed. Exception: &quot;</span>, exception);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw a bitmap</span></div>
<div class="line">            args.Graphics.DrawImage(_bitmap.Bitmap, <span class="keyword">new</span> Point(0, 0));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw skeleton joints</span></div>
<div class="line">            <span class="keywordflow">if</span> (_skeletonData != null)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">int</span> jointSize = 10;</div>
<div class="line">                <span class="keywordflow">foreach</span> (var skeleton <span class="keywordflow">in</span> _skeletonData.Skeletons)</div>
<div class="line">                {</div>
<div class="line">                    SolidBrush brush = <span class="keyword">new</span> SolidBrush(Color.FromArgb(255 - 40 * skeleton.ID, 0, 0));</div>
<div class="line">                    <span class="keywordflow">foreach</span> (var joint <span class="keywordflow">in</span> skeleton.Joints)</div>
<div class="line">                    {</div>
<div class="line">                        args.Graphics.FillEllipse(brush, joint.Proj.X * _bitmap.Width - jointSize / 2,</div>
<div class="line">                                                  joint.Proj.Y * _bitmap.Height - jointSize / 2, jointSize, jointSize);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw hand pointers</span></div>
<div class="line">            <span class="keywordflow">if</span> (_handTrackerData != null)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">foreach</span> (var userHands <span class="keywordflow">in</span> _handTrackerData.UsersHands)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (userHands.LeftHand != null)</div>
<div class="line">                    {</div>
<div class="line">                        HandContent hand = userHands.LeftHand.Value;</div>
<div class="line">                        <span class="keywordtype">int</span> size = hand.Click ? 20 : 30;</div>
<div class="line">                        Brush brush = <span class="keyword">new</span> SolidBrush(Color.Aquamarine);</div>
<div class="line">                        args.Graphics.FillEllipse(brush, hand.X * _bitmap.Width - size/2, hand.Y * _bitmap.Height - size / 2, size, size);</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (userHands.RightHand != null)</div>
<div class="line">                    {</div>
<div class="line">                        HandContent hand = userHands.RightHand.Value;</div>
<div class="line">                        <span class="keywordtype">int</span> size = hand.Click ? 20 : 30;</div>
<div class="line">                        Brush brush = <span class="keyword">new</span> SolidBrush(Color.DarkBlue);</div>
<div class="line">                        args.Graphics.FillEllipse(brush, hand.X * _bitmap.Width - size/2, hand.Y * _bitmap.Height - size / 2, size, size);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Update Form</span></div>
<div class="line">            this.Invalidate();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onIssueDataUpdate(IssuesData issuesData)</div>
<div class="line">        {</div>
<div class="line">            _issuesData = issuesData;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the DepthSensorUpdate event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onDepthSensorUpdate(DepthFrame depthFrame)</div>
<div class="line">        {</div>
<div class="line">            _depthFrame = depthFrame;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the ColorSensorUpdate event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onColorSensorUpdate(ColorFrame colorFrame)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (!_visualizeColorImage)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">            _colorStreamEnabled = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> wStep = (float)_bitmap.Width / colorFrame.Cols;</div>
<div class="line">            <span class="keywordtype">float</span> hStep = (<span class="keywordtype">float</span>)_bitmap.Height / colorFrame.Rows;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordtype">float</span> nextVerticalBorder = hStep;</div>
<div class="line">            </div>
<div class="line">            Byte[] data = colorFrame.Data;</div>
<div class="line">            <span class="keywordtype">int</span> colorPtr = 0;</div>
<div class="line">            <span class="keywordtype">int</span> bitmapPtr = 0;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> elemSizeInBytes = 3;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _bitmap.Height; ++i)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == (<span class="keywordtype">int</span>)nextVerticalBorder)</div>
<div class="line">                {</div>
<div class="line">                    colorPtr += colorFrame.Cols * elemSizeInBytes;</div>
<div class="line">                    nextVerticalBorder += hStep;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">int</span> offset = 0;</div>
<div class="line">                <span class="keywordtype">int</span> argb = data[colorPtr]</div>
<div class="line">                    | (data[colorPtr + 1] &lt;&lt; 8)</div>
<div class="line">                    | (data[colorPtr + 2] &lt;&lt; 16)</div>
<div class="line">                    | (0xFF &lt;&lt; 24);</div>
<div class="line">                <span class="keywordtype">float</span> nextHorizontalBorder = wStep;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; _bitmap.Width; ++j)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)nextHorizontalBorder)</div>
<div class="line">                    {</div>
<div class="line">                        offset += elemSizeInBytes;</div>
<div class="line">                        argb = data[colorPtr + offset]</div>
<div class="line">                            | (data[colorPtr + offset + 1] &lt;&lt; 8)</div>
<div class="line">                            | (data[colorPtr + offset + 2] &lt;&lt; 16)</div>
<div class="line">                            | (0xFF &lt;&lt; 24);</div>
<div class="line">                        nextHorizontalBorder += wStep;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    _bitmap.Bits[bitmapPtr++] = argb;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the UserTrackerUpdate event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onUserTrackerUpdate(UserFrame userFrame)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (_visualizeColorImage &amp;&amp; _colorStreamEnabled)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (_depthFrame == null)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_LABELS = 7;</div>
<div class="line">            <span class="keywordtype">bool</span>[] labelIssueState = <span class="keyword">new</span> <span class="keywordtype">bool</span>[MAX_LABELS];</div>
<div class="line">            <span class="keywordflow">for</span> (UInt16 label = 0; label &lt; MAX_LABELS; ++label)</div>
<div class="line">            {</div>
<div class="line">                labelIssueState[label] = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (_issuesData != null)</div>
<div class="line">                {</div>
<div class="line">                    FrameBorderIssue frameBorderIssue = _issuesData.GetUserIssue&lt;FrameBorderIssue&gt;(label);</div>
<div class="line">                    labelIssueState[label] = (frameBorderIssue != null);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> wStep = (float)_bitmap.Width / _depthFrame.Cols;</div>
<div class="line">            <span class="keywordtype">float</span> hStep = (<span class="keywordtype">float</span>)_bitmap.Height / _depthFrame.Rows;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> nextVerticalBorder = hStep;</div>
<div class="line"></div>
<div class="line">            Byte[] dataDepth = _depthFrame.Data;</div>
<div class="line">            Byte[] dataUser = userFrame.Data;</div>
<div class="line">            <span class="keywordtype">int</span> dataPtr = 0;</div>
<div class="line">            <span class="keywordtype">int</span> bitmapPtr = 0;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> elemSizeInBytes = 2;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _bitmap.Height; ++i)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == (<span class="keywordtype">int</span>)nextVerticalBorder)</div>
<div class="line">                {</div>
<div class="line">                    dataPtr += _depthFrame.Cols * elemSizeInBytes;</div>
<div class="line">                    nextVerticalBorder += hStep;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">int</span> offset = 0;</div>
<div class="line">                <span class="keywordtype">int</span> argb = 0;</div>
<div class="line">                <span class="keywordtype">int</span> label = dataUser[dataPtr] | dataUser[dataPtr + 1] &lt;&lt; 8;</div>
<div class="line">                <span class="keywordtype">int</span> depth = Math.Min(255, (dataDepth[dataPtr] | dataDepth[dataPtr + 1] &lt;&lt; 8) / 32);</div>
<div class="line">                <span class="keywordtype">float</span> nextHorizontalBorder = wStep;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; _bitmap.Width; ++j)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (j == (<span class="keywordtype">int</span>)nextHorizontalBorder)</div>
<div class="line">                    {</div>
<div class="line">                        offset += elemSizeInBytes;</div>
<div class="line">                        label = dataUser[dataPtr + offset] | dataUser[dataPtr + offset + 1] &lt;&lt; 8;</div>
<div class="line">                        <span class="keywordflow">if</span> (label == 0)</div>
<div class="line">                            depth = Math.Min(255, (dataDepth[dataPtr + offset] | dataDepth[dataPtr + offset + 1] &lt;&lt; 8) / 32);</div>
<div class="line">                        nextHorizontalBorder += wStep;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (label &gt; 0)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordtype">int</span> user = label * 40;</div>
<div class="line">                        <span class="keywordflow">if</span> (!labelIssueState[label])</div>
<div class="line">                            user += 40;</div>
<div class="line">                        argb = 0 | (user &lt;&lt; 8) | (0 &lt;&lt; 16) | (0xFF &lt;&lt; 24);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        argb = depth | (depth &lt;&lt; 8) | (depth &lt;&lt; 16) | (0xFF &lt;&lt; 24);</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    _bitmap.Bits[bitmapPtr++] = argb;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the SkeletonUpdate event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onSkeletonUpdate(SkeletonData skeletonData)</div>
<div class="line">        {</div>
<div class="line">            _skeletonData = skeletonData;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the HandTrackerUpdate event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onHandTrackerUpdate(HandTrackerData handTrackerData)</div>
<div class="line">        {</div>
<div class="line">            _handTrackerData = handTrackerData;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Event handler for the gesture detection event</span></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> onNewGestures(GestureData gestureData)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Display the information about detected gestures in the console</span></div>
<div class="line">            <span class="keywordflow">foreach</span> (var gesture <span class="keywordflow">in</span> gestureData.Gestures)</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Recognized {0} from user {1}&quot;</span>, gesture.Type.ToString(), gesture.UserID);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Aug 22 2019 12:41:44 for Nuitrack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
