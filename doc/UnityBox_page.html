<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Nuitrack: Creating a VR Boxing Game</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nuitrack.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nuitrack
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">3D Skeleton Tracking Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('UnityBox_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Creating a VR Boxing Game </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#box_environment">Creating VR Environment and animating the Avatar</a></li>
<li class="level1"><a href="#box_dummy">Setting Up the punching Dummy</a></li>
<li class="level1"><a href="#box_speed">Punching the Dummy and displaying the Punch Speed</a></li>
</ul>
</div>
<div class="textblock"><p>So, you've decided to create a VR game with skeleton tracking but don't know what to start with? Well, you're at the right page because in this tutorial you'll learn how to create a VR game using <b>Nuitrack</b>. To plunge into the subject and to understand how to animate your avatar's skeleton in a VR game, we recommend you to take a look at our tutorial <a href="http://download.3divi.com/Nuitrack/doc/UnityAnimation_page.html">Animating the Avatar using Skeleton</a>.</p>
<p>In this tutorial, we'll create a simple VR game, in which your avatar is a boxer and you have to punch a dummy as hard as you can. The maximum punch speed will be measured and displayed at the top of the screen. To make this game, you'll need the <b>Nuitrack SDK</b>, a sensor (from the list of supported sensors, see the <a href="https://nuitrack.com/">Nuitrack website</a>) and a VR headset (any Mobile VR headset or Gear VR headset). Recommended Unity version: 2017.4 or higher.</p>
<p>You can find the finished project in <b>Nuitrack SDK</b>: <b>Unity 3D → NuitrackSDK.unitypackage → Tutorials → Box</b></p>
<div class="image">
<img src="Ubox_9.gif" alt="Ubox_9.gif"/>
</div>
 <h1><a class="anchor" id="box_environment"></a>
Creating VR Environment and animating the Avatar</h1>
<ol>
<li>
Create a new Unity project. </li>
<li>
<p class="startli">Import <b>NuitrackSDK.unitypackage</b> from the <b>Nuitrack SDK: Assets → Import Package → Custom Package</b>. Tick the following folders that we'll need for work: </p>
<ul>
<li>
<b>Nuitrack</b> (includes all Nuitrack modules and is responsible for skeleton detection, tracking, etc. Also, this folder includes a Head prefab that is used in VR games, and a file with settings for Nuitrack automatic calibration); </li>
<li>
<b>Platform Changer</b> (changes the Unity settings (<b>PlayerSettings</b>) according to the selected platform); </li>
<li>
<b>Plugins</b> (includes <b>Android Manifest</b> that specifies permissions and other settings of your app); </li>
<li>
<b>Resources</b> (stores the <b>Platform Changer</b> settings); </li>
<li>
<b>Tutorials → Box</b> (we need this folder for our project because it includes the Dummy prefab. Also, you can find here a finished VR Boxing Game for reference); </li>
<li>
<b>Tutorials → Avatar Animation</b> (includes the Unitychan prefab that we'll use to display our Boxer (very interesting choice, huh?); </li>
<li>
<b>VicoVRCalibrationRGB</b> (includes all the necessary components for calibration in the T-Pose. Calibration is required for any VR game). </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><b>Nuitrack</b> provides improved automatic calibration for Android and Gear VR. Any gyroscope has one unpleasant feature: when you turn the head during a game, its position may become slightly distorted and rotation is not aligned back, which may affect your gaming experience. Fortunately, <b>Nuitrack automatic calibration</b> helps to eliminate this nuisance. By default, automatic calibration is enabled, however, if you'd like to disable it for some reason, you can do it using the <b>VicoVR app: Settings → Developer Options → Autocalibration (Off)</b>.</dd></dl>
</li>
<li>
Create a new Scene: <b>File → New Scene</b>. Drag-and-drop the following prefabs to the Scene: <ul>
<li>
<b>NuitrackScripts</b> (includes the <b>Nuitrack Manager</b> components (initiates Nuitrack and its modules), <b>Current User Tracker</b> (responsible for tracking of a current user), <b>T-Pose Calibration</b> (determines the calibration settings), <b>Calibration Info</b> (stores the calibration settings); </li>
<li>
<b>RiggedAvatar2</b> (includes all the components for direct skeleton mapping. In this game, we'll animate the avatar using direct mapping to make its moves more accurate and smooth. Learn more about the difference between direct and indirect mapping in our tutorial <a href="http://download.3divi.com/Nuitrack/doc/UnityAnimation_page.html">Animating the Avatar using Skeleton</a>; </li>
<li>
<b>HeadParent</b> (head of our avatar; contains the camera and scripts that define the rotation of the head). </li>
</ul>
</li>
<li>
<p class="startli">Hide the head of the Unitychan prefab so that you won't see it from the inside during our VR game: <b>Character1_Neck → Transform → Scale (0; 0; 0)</b></p>
<div class="image">
<img src="Ubox_1.png" alt="Ubox_1.png"/>
<div class="caption">
Hiding the Head</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">In the <b>NuitrackAvatar</b> settings, drag-and-drop the <b>HeadParent</b> to <b>Element 16</b>, so that our avatar will be able to move her head.</p>
<div class="image">
<img src="Ubox_2.png" alt="Ubox_2.png"/>
<div class="caption">
Setting Up the Head</div></div>
 <dl class="section note"><dt>Note</dt><dd>The default platform in a project is <b>Android</b>. Before building the project, you can select the appropriate platform: <b>iOS, Android (default) or GearVR</b>. To do that, select <b>Windows → Platform Changer → TargetPlatform → Change Platform</b>.</dd></dl>
</li>
<li>
Build and run the project. Calibration should run and reach 100%. After that, check that your avatar is displayed correctly and her movements correspond to yours. </li>
</ol>
<div class="image">
<img src="Ubox_3.gif" alt="Ubox_3.gif"/>
<div class="caption">
Calibration in the T-Pose</div></div>
 <h1><a class="anchor" id="box_dummy"></a>
Setting Up the punching Dummy</h1>
<ol>
<li>
Now, when we've created our avatar, it's time to introduce our victim - a punching dummy (or, alternatively, you can use the avatar of a person who pisses you off - just kidding). Drag-and-drop the <b>PunchingDummy</b> prefab to the Scene. </li>
<li>
<p class="startli">Create a new script <em>PunchSpeedMeter.cs</em>. In this script, we'll determine when the dummy appears and also define all the settings associated with the speed of our punch. In the script, create fields for the dummy and transformTarget (which is a spine joint; we use this very joint because this is the first moving joint in the hierarchy and it defines the moves of other body joints).</p>
<div class="fragment"><div class="line">[SerializeField] GameObject dummy;</div>
<div class="line">[SerializeField] Transform transformTarget;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>Awake</em> method that will be executed at startup: deactivate the dummy so that it isn't displayed during calibration.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> Awake()</div>
<div class="line">{</div>
<div class="line">    dummy.SetActive(<span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>OnEnable</em> method. Subscribe to the <em>onSuccess</em> event from the <em>TPoseCalibration</em> script. It's called if calibration is successful.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> OnEnable()</div>
<div class="line">{    </div>
<div class="line">    TPoseCalibration.Instance.onSuccess += OnSuccessCalibration;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>OnSuccessCalibration</em> method and specify the required argument <em>(Quaternion rotation)</em>. In this method, we define the initial position of the dummy in front of our avatar. The dummy is activated after successful calibration and stands at a distance of 1m from the user and 1m below the target joint set in the editor (you can specify any distance that you want).</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OnSuccessCalibration(Quaternion rotation)</div>
<div class="line">{</div>
<div class="line">    dummy.SetActive(<span class="keyword">true</span>);</div>
<div class="line">    transform.position = transformTarget.position + <span class="keyword">new</span> Vector3(0, -1, 1);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Don't forget to unsubscribe from the <em>OnSuccessCalibration</em> event.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> OnDisable()</div>
<div class="line">{</div>
<div class="line">    TPoseCalibration.Instance.onSuccess -= OnSuccessCalibration;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Drag-and-drop the script to the dummy. In Unity, drag-and-drop the <b>Dummy</b> to <b>Dummy</b> and <b>Character1_Spine</b> to <b>Transform Target</b> (the dummy will be set in relation to this joint).</p>
<div class="image">
<img src="Ubox_4.png" alt="Ubox_4.png"/>
<div class="caption">
Setting Up the Punching Dummy</div></div>
 <p class="endli"></p>
</li>
<li>
Run the project and check that the dummy is displayed correctly. At this stage, you won't be able to punch him because we haven't set up the hands of our character yet, so, the hand will just move through the dummy. </li>
</ol>
<div class="image">
<img src="Ubox_5.gif" alt="Ubox_5.gif"/>
<div class="caption">
You should see the dummy after calibration</div></div>
 <h1><a class="anchor" id="box_speed"></a>
Punching the Dummy and displaying the Punch Speed</h1>
<ol>
<li>
<p class="startli">Have you ever played on the 'Punching Bag' game machine that measures the force of your punch? In this project, you'll have the opportunity to break your record several times: the maximum speed of your punch will be displayed above the dummy and will be updated every time the record is broken. In the <em>PunchSpeedMeter.cs</em> script, add the <em>UI</em> namespace, which we need to display text with information about the speed of our punch. Also, create the <em>Text</em> field.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine.UI;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>PunchSpeedMeter : MonoBehaviour {</div>
<div class="line">    ...</div>
<div class="line">    [SerializeField] Text speedMeterText;</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>PunchSpeedMeter</em> class, add the <em>maximumPunchSpeed</em> variable to store the information about the maximum speed of a punch.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> maximumPunchSpeed = 0;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>CalculateMaxPunchSpeed</em> method (which takes the punch speed). If the new speed is greater than the current speed, the counter will be updated, otherwise the result will not change.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> CalculateMaxHitSpeed(<span class="keywordtype">float</span> speed)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (maximumPunchSpeed &lt; speed)</div>
<div class="line">        maximumPunchSpeed = speed;</div>
<div class="line">    speedMeterText.text = maximumPunchSpeed + <span class="stringliteral">&quot; m/s &quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create a new script <em>PunchSpeedSender.cs</em>. We need a handler for punches, since we can punch the dummy in several body parts (<b>TorsoBone</b> and <b>NeckBone</b>). When you punch the dummy in one of these parts, the <b>PunchSpeedSender</b> sends the info about that event to the <b>PunchSpeedMeter</b>. In this script, make a reference to the <b>PunchSpeedMeter</b> and create the <em>OnCollisionEnter</em> method. When two objects collide, we'll get the relative punch speed.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>HitSpeedSender : MonoBehaviour {</div>
<div class="line"> </div>
<div class="line">    [SerializeField] HitSpeedMeter hitSpeedMeter;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> OnCollisionEnter(Collision collision)</div>
<div class="line">    {</div>
<div class="line">        hitSpeedMeter.CalculateMaxHitSpeed(collision.relativeVelocity.magnitude);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The <em>relativeVelocity</em> property allows to determine the correct collision speed of two objects (in our case, these are the Unitychan's fist and the dummy). In case we only determined the speed of the fist, we'd get an incorrect value. To learn more about <em>relativeVelocity</em>, click <a href="https://docs.unity3d.com/ScriptReference/Collision-relativeVelocity.html">here</a>.</dd></dl>
</li>
<li>
<p class="startli">In Unity, drag-and-drop this script to the <b>TorsoBone</b> and <b>NeckBone</b>. In the <b>Punch Speed Meter</b> field, specify <b>PunchSpeedMeter</b>.</p>
<div class="image">
<img src="Ubox_6.png" alt="Ubox_6.png"/>
<div class="caption">
Punch Speed Sender Settings</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">In Unity, create two objects for the 'boxing gloves' of our avatar: <b>Create → Empty Object → Left Glove, Right Glove</b>. Actually, our avatar will punch the dummy with her bare hands, but we need to attach imaginary 'boxing gloves' to her hands in order to calculate the punch speed. Let's add the necessary components: <b>Add Component → Capsule Collider, RigidBody</b> to handle the collisions correctly. Select the direction for glove movement along the arm: <b>Capsule Collider → Direction → X-Axis</b>. Set the position and size of the 'gloves': <b>Height → 0.2</b> (optimum), <b>Radius → 0.05</b>. If you want to display the boxing gloves, then create the appropriate prefab and apply the above settings to it.</p>
<div class="image">
<img src="Ubox_7.png" alt="Ubox_7.png"/>
<div class="caption">
Setting Up the Gloves</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">Create the script <em>RigidbodyFollower.cs</em> and describe the behavior of our 'gloves'. Create the <em>target</em> field so that our 'gloves' will follow these target objects (in our case, these are the avatar's hands). Also, create the <em>rigidbody</em> field.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>RigidbodyFollower : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    [SerializeField] Transform target;</div>
<div class="line"> </div>
<div class="line">    Rigidbody rigidbody;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">At the start of the game, a reference to the Rigidbody that's attached to the capsule will be received.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Start()</div>
<div class="line">{</div>
<div class="line">    rigidbody = GetComponent&lt;Rigidbody&gt;();</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>FixedUpdate</em> method. In this method, we'll describe the behavior of the capsule: it will move (position, rotation) according to the target transform. In this project we use <em>MovePosition</em> instead of <em>transform.position</em> because the gloves of our avatar should move using the RigidBody Physics. A simple change of position may be processed incorrectly because every time the transform would 'teleport' ignoring the physics.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> FixedUpdate()</div>
<div class="line">{</div>
<div class="line">    rigidbody.MovePosition(target.position);</div>
<div class="line">    rigidbody.MoveRotation(target.rotation);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>We use <em>FixedUpdate</em> instead of <em>Update</em> in case we are dealing with <em>Rigidbody</em>.</dd></dl>
</li>
<li>
<p class="startli">Drag-and-drop the script to the right and left glove and specify the <b>Target (Character1_LeftHand, Character1_RightHand)</b>.</p>
<div class="image">
<img src="Ubox_8.png" alt="Ubox_8.png"/>
<div class="caption">
Setting Up the Rigidbody Follower</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">Run the project and punch the dummy. Check the displayed speed of your punch: it should be displayed above the dummy. Try to break your record several times!</p>
<div class="image">
<img src="Ubox_9.gif" alt="Ubox_9.gif"/>
<div class="caption">
Beat him up!</div></div>
 <p class="endli">Congratulations! You've just created a VR Boxing Game with skeleton tracking! </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="UnityTutorials_page.html">Unity Tutorials</a></li>
    <li class="footer">Generated on Thu Aug 22 2019 12:41:45 for Nuitrack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
