<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Nuitrack: Displaying Skeletons on an RGB Image</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nuitrack.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nuitrack
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">3D Skeleton Tracking Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('UnityRGBandSkeletons_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Displaying Skeletons on an RGB Image </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rgb_settings">Setting Up the Scene and Getting RGB Output from a Sensor</a></li>
<li class="level1"><a href="#rgb_skeleton">Displaying the Skeleton</a></li>
<li class="level1"><a href="#rgb_skeletons">Displaying Multiple Skeletons</a></li>
</ul>
</div>
<div class="textblock"><p>In this tutorial, you'll learn how to display a color image from your sensor in a Unity project and display the skeletons of users received from Nuitrack.<br/>
 <br/>
 You can find the finished project in <b>Nuitrack SDK: Unity 3D → NuitrackSDK.unitypackage → Tutorials → RGB and Skeletons</b><br/>
 <br/>
 To create this project, you'll need just a couple of things: </p>
<ul>
<li>
Nuitrack Runtime and Nuitrack SDK </li>
<li>
Any supported sensor (see the complete list at <a href="https://nuitrack.com/">Nuitrack website</a>) </li>
<li>
Unity 2017.4 or higher </li>
</ul>
<div class="image">
<img src="Urgb_1.gif" alt="Urgb_1.gif"/>
</div>
 <h1><a class="anchor" id="rgb_settings"></a>
Setting Up the Scene and Getting RGB Output from a Sensor</h1>
<ol>
<li>
Create a new project. </li>
<li>
Download <b>Nuitrack SDK</b> and import <b>NuitrackSDK.unitypackage</b> to your project (<b>Assets → Import Package → Custom Package...</b>) except <b>Tutorials/RGBandSkeletons/FinalAssets</b> and <b>Tutorials/FaceTracker/Final Assets</b>. </li>
<li>
Drag-and-drop the <b>NuitrackScripts</b> prefab to the scene (this prefab allows you to use Nuitrack modules in your project). </li>
<li>
<p class="startli">In the <b>Nuitrack Manager</b> section of the <b>NuitrackScripts</b> prefab, tick the necessary modules: <b>Color Module On</b> (to display the RGB image), <b>Skeleton Tracker Module On</b> (for skeleton tracking, as you can guess).</p>
<div class="image">
<img src="Urgb_2.png" alt="Urgb_2.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Create a new script and name it <em>DrawColorFrame</em>. In this script, determine the output of an RGB image to the scene. </li>
<li>
<p class="startli">Create a public field <em>RawImage background</em> to display the image. In <em>Start</em>, subscribe to update each color frame.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> UnityEngine.UI;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>DrawColorFrame : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    [SerializeField] RawImage background;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        NuitrackManager.onColorUpdate += DrawColor;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Why do we use <em>RawImage</em> instead of <em>Image</em> in this project? <em>Image</em> is used for displaying Sprites only. <em>RawImage</em> is used for displaying any type of texture. Sprites are easier to work with, but <em>Sprite.Create</em> is an expensive operation. It takes a comparatively long time and uses a lot of memory. By using a <em>RawImage</em> you can skip the step of creating a sprite. <em>RawImage</em> accepts the texture, which we've created with <em>ToTexture2D()</em> from the data received from Nuitrack (frame).</dd></dl>
</li>
<li>
<p class="startli">In the <em>DrawColor</em> method, get the texture of <em>ColorFrame</em> and pass it to the <em>background</em> texture.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>DrawColorFrame : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    <span class="keywordtype">void</span> DrawColor(nuitrack.ColorFrame frame)</div>
<div class="line">    { </div>
<div class="line">        background.texture = frame.ToTexture2D();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If you observe memory leak, try to delete the old texture (for example, using <em>Destroy(oldTexture)</em>) before you display the new texture.</dd></dl>
</li>
<li>
Create a new <b>Canvas</b> on the scene (<b>Create → UI → Canvas</b>). After this, create a child object to the <b>Canvas</b>: <b>Create → UI → Raw Image</b>. The received texture (the image from a sensor) is stretched across the <b>Raw Image</b>. </li>
<li>
<p class="startli">In the <b>Raw Image</b> settings, select <b>Anchor Presets</b>, press <b>Alt</b> and stretch the object across the width and height of the <b>Canvas</b>.</p>
<div class="image">
<img src="Urgb_3.png" alt="Urgb_3.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">Rotate <b>RawImage</b> by 180 degrees along X (otherwise, the output image will be inverted).</p>
<div class="image">
<img src="Urgb_4.png" alt="Urgb_4.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Rename <b>Canvas</b> to <b>ColorFrameCanvas</b> and add the <em>DrawColorFrame</em> script to it. </li>
<li>
<p class="startli">Drag-and-drop the <b>Raw Image</b> to the <b>Background</b> field of the script.</p>
<div class="image">
<img src="Urgb_5.png" alt="Urgb_5.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Run the project. You should see a color image from the sensor displayed on the screen. </li>
</ol>
<div class="image">
<img src="Urgb_6.gif" alt="Urgb_6.gif"/>
</div>
 <h1><a class="anchor" id="rgb_skeleton"></a>
Displaying the Skeleton</h1>
<ol>
<li>
All right, color image from the sensor is fun, but we're interested in the skeletons of users (otherwise, what do we need Nuitrack for?) Let's start tracking and displaying skeletons. First of all, turn on <b>depth-to-color registration</b> because a depth map doesn't accurately match an RGB image and we have to align them. To turn on depth-to-color registration, you have to open <em>nuitrack.config</em> and set <em>DepthProvider.Depth2ColorRegistration</em> to true. </li>
<li>
Create two prefabs to display a user's skeleton (a ball for a joint and a line for a connection). As an option, you can use the prefabs from <b>NuitrackSDK.unitypackage</b> (<b>Assets/NuitrackSDK/Tutorials/RGBandSkeletons/Prefabs (JointUI and ConnectionUI)</b>). </li>
<li>
Create a new script and name it <em>SimpleSkeletonAvatar</em>. In this script, determine tracking and displaying of a single skeleton. </li>
<li>
Create a new bool variable <em>autoProcessing</em>. If we need to process only one skeleton, we set the value of this variable to <em>true</em> and Nuitrack passes all data about this skeleton. At this stage, this is quite sufficient because we want to display only one skeleton. However, when it comes to displaying several skeletons, we'll need additional components, because multiple skeletons cannot be processed automatically. </li>
<li>
<p class="startli">Create two fields for the joint and connection prefabs: <em>jointPrefab</em> and <em>connectionPrefab</em>.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">bool</span> autoProcessing = <span class="keyword">true</span>;</div>
<div class="line">    [SerializeField] GameObject jointPrefab = null, connectionPrefab = null;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>jointsInfo</em> array with the list of all joints that are needed to display the skeleton. All in all, there are 19 joints tracked by Nuitrack.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    nuitrack.JointType[] jointsInfo = <span class="keyword">new</span> nuitrack.JointType[]</div>
<div class="line">    {</div>
<div class="line">        nuitrack.JointType.Head,</div>
<div class="line">        nuitrack.JointType.Neck,</div>
<div class="line">        nuitrack.JointType.LeftCollar,</div>
<div class="line">        nuitrack.JointType.Torso,</div>
<div class="line">        nuitrack.JointType.Waist,</div>
<div class="line">        nuitrack.JointType.LeftShoulder,</div>
<div class="line">        nuitrack.JointType.RightShoulder,</div>
<div class="line">        nuitrack.JointType.LeftElbow,</div>
<div class="line">        nuitrack.JointType.RightElbow,</div>
<div class="line">        nuitrack.JointType.LeftWrist,</div>
<div class="line">        nuitrack.JointType.RightWrist,</div>
<div class="line">        nuitrack.JointType.LeftHand,</div>
<div class="line">        nuitrack.JointType.RightHand,</div>
<div class="line">        nuitrack.JointType.LeftHip,</div>
<div class="line">        nuitrack.JointType.RightHip,</div>
<div class="line">        nuitrack.JointType.LeftKnee,</div>
<div class="line">        nuitrack.JointType.RightKnee,</div>
<div class="line">        nuitrack.JointType.LeftAnkle,</div>
<div class="line">        nuitrack.JointType.RightAnkle</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create a 2D array containing all the connections. Specify the initial and end joints (a connection is created between these two joints).</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    nuitrack.JointType[,] connectionsInfo = <span class="keyword">new</span> nuitrack.JointType[,]</div>
<div class="line">    { </div>
<div class="line">        {nuitrack.JointType.Neck,           nuitrack.JointType.Head},</div>
<div class="line">        {nuitrack.JointType.LeftCollar,     nuitrack.JointType.Neck},</div>
<div class="line">        {nuitrack.JointType.LeftCollar,     nuitrack.JointType.LeftShoulder},</div>
<div class="line">        {nuitrack.JointType.LeftCollar,     nuitrack.JointType.RightShoulder},</div>
<div class="line">        {nuitrack.JointType.LeftCollar,     nuitrack.JointType.Torso},</div>
<div class="line">        {nuitrack.JointType.Waist,          nuitrack.JointType.Torso},</div>
<div class="line">        {nuitrack.JointType.Waist,          nuitrack.JointType.LeftHip},</div>
<div class="line">        {nuitrack.JointType.Waist,          nuitrack.JointType.RightHip},</div>
<div class="line">        {nuitrack.JointType.LeftShoulder,   nuitrack.JointType.LeftElbow},</div>
<div class="line">        {nuitrack.JointType.LeftElbow,      nuitrack.JointType.LeftWrist},</div>
<div class="line">        {nuitrack.JointType.LeftWrist,      nuitrack.JointType.LeftHand},</div>
<div class="line">        {nuitrack.JointType.RightShoulder,  nuitrack.JointType.RightElbow},</div>
<div class="line">        {nuitrack.JointType.RightElbow,     nuitrack.JointType.RightWrist},</div>
<div class="line">        {nuitrack.JointType.RightWrist,     nuitrack.JointType.RightHand},</div>
<div class="line">        {nuitrack.JointType.LeftHip,        nuitrack.JointType.LeftKnee},</div>
<div class="line">        {nuitrack.JointType.LeftKnee,       nuitrack.JointType.LeftAnkle},</div>
<div class="line">        {nuitrack.JointType.RightHip,       nuitrack.JointType.RightKnee},</div>
<div class="line">        {nuitrack.JointType.RightKnee,      nuitrack.JointType.RightAnkle}</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create an array containing ready-made connections and a dictionary with ready-made joints (the key is a joint type and the value is a spawned object).</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    GameObject[] connections;</div>
<div class="line">    Dictionary&lt;nuitrack.JointType, GameObject&gt; joints;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In <em>Start</em>, call the <em>CreateSkeletonParts</em> method.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        CreateSkeletonParts();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>CreateSkeletonParts</em> method, create all joints and connections. Joints are spawned, turned off and added to the list of joints. Do the same thing with all connections. Joints and connections are "turned on" as soon as a skeleton is detected.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…    </div>
<div class="line">    <span class="keywordtype">void</span> CreateSkeletonParts()</div>
<div class="line">    {</div>
<div class="line">        joints = <span class="keyword">new</span> Dictionary&lt;nuitrack.JointType, GameObject&gt;();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; jointsInfo.Length; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (jointPrefab != null)</div>
<div class="line">            {</div>
<div class="line">                GameObject joint = Instantiate(jointPrefab, transform, <span class="keyword">true</span>);</div>
<div class="line">                joint.SetActive(<span class="keyword">false</span>);</div>
<div class="line">                joints.Add(jointsInfo[i], joint);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        connections = <span class="keyword">new</span> GameObject[connectionsInfo.GetLength(0)];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; connections.Length; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (connectionPrefab != null)</div>
<div class="line">            {</div>
<div class="line">                GameObject connection = Instantiate(connectionPrefab, transform, <span class="keyword">true</span>);</div>
<div class="line">                connection.SetActive(<span class="keyword">false</span>);</div>
<div class="line">                connections[i] = connection;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create a new method <em>ProcessSkeleton</em> for processing the skeleton received from Nuitrack. Check for null values (if a skeleton isn't detected, the other part of the method won't be executed).</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> ProcessSkeleton(nuitrack.Skeleton skeleton)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (skeleton == null)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Loop over the joints. If a specific joint is detected (confidence &gt; 0.5), it's displayed and its position is set in 2D (projective coordinates received from Nuitrack are used). Otherwise, the joint is not displayed.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> ProcessSkeleton(nuitrack.Skeleton skeleton)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; jointsInfo.Length; i++)</div>
<div class="line">        {</div>
<div class="line">            nuitrack.Joint j = skeleton.GetJoint(jointsInfo[i]);</div>
<div class="line">            <span class="keywordflow">if</span> (j.Confidence &gt; 0.5f)</div>
<div class="line">            {</div>
<div class="line">                joints[jointsInfo[i]].SetActive(<span class="keyword">true</span>);</div>
<div class="line">                <span class="comment">// Bring proj coordinates from Nuitrack into accordance with screen coordinates</span></div>
<div class="line">                joints[jointsInfo[i]].transform.position = <span class="keyword">new</span> Vector2(j.Proj.X * Screen.width, Screen.height - j.Proj.Y * Screen.height);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                joints[jointsInfo[i]].SetActive(<span class="keyword">false</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Currently, there are only two values of confidence: 0 (Nuitrack thinks that this isn't a joint) and 0.75 (a joint).</dd></dl>
</li>
<li>
<p class="startli">Loop over the connections. If both joint models required to create the connection are displayed (the initial and end joint), activate the connection. Set the connection position based on the positions of corresponding joint models. To rotate the connection, use the difference between the positions of the initial and end joints. Calculate the connection size: </p>
<ul>
<li>
find the distance between the initial and end joints; </li>
<li>
set the size: Vector3 (distance, 1, 1) </li>
</ul>
<p>If any joint required to create the connection is not displayed, the connection is not displayed, too.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> ProcessSkeleton(nuitrack.Skeleton skeleton)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; connectionsInfo.GetLength(0); i++)</div>
<div class="line">        {</div>
<div class="line">            GameObject startJoint = joints[connectionsInfo[i, 0]];</div>
<div class="line">            GameObject endJoint = joints[connectionsInfo[i, 1]];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (startJoint.activeSelf &amp;&amp; endJoint.activeSelf)</div>
<div class="line">            {</div>
<div class="line">                connections[i].SetActive(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">                connections[i].transform.position = startJoint.transform.position;</div>
<div class="line">                connections[i].transform.right = endJoint.transform.position - startJoint.transform.position;</div>
<div class="line">                <span class="keywordtype">float</span> distance = Vector3.Distance(endJoint.transform.position,  startJoint.transform.position);</div>
<div class="line">                connections[i].transform.localScale = <span class="keyword">new</span> Vector3(distance, 1f, 1f);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                connections[i].SetActive(<span class="keyword">false</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In <em>Update</em>, if <em>autoProcessing</em> is set to <em>true</em>, call the <em>ProcessSkeleton</em> and pass the parameters <em>CurrentUserTracker.CurrentSkeleton</em>.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SimpleSkeletonAvatar : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">…    </div>
<div class="line">    <span class="keywordtype">void</span> Update()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (autoProcessing)</div>
<div class="line">            ProcessSkeleton(CurrentUserTracker.CurrentSkeleton);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create a new <b>Canvas</b> named <b>SkeletonsCanvas</b>. Set its <b>Sort Order</b> to <b>1</b>, so that skeletons are displayed over the <b>ColorFrameCanvas</b>.</p>
<div class="image">
<img src="Urgb_7.png" alt="Urgb_7.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Create a child object to the <b>SkeletonsCanvas</b> (<b>Create Empty</b>) and name it <b>Simple Skeleton Avatar</b>. We'll use this object to display the skeleton. Drag-and-drop the <em>SimpleSkeletonAvatar</em> script to this object. </li>
<li>
<p class="startli">Drag-and-drop the <b>jointUI</b> prefab (<b>Tutorials/RGBandSkeletons/Prefabs</b>) to the <b>Joint Prefab</b> field. Drag-and-drop the <b>ConnectionUI</b> prefab (from the same folder) to the <b>Connection Prefab</b> field.</p>
<div class="image">
<img src="Urgb_8.png" alt="Urgb_8.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
Run the project. At this point, you should see a 2D skeleton displayed over the RGB image from the sensor. However, if there are several users, their skeletons won't be displayed. Let's move on to the next point so as not to upset them. </li>
</ol>
<div class="image">
<img src="Urgb_9.gif" alt="Urgb_9.gif"/>
</div>
 <h1><a class="anchor" id="rgb_skeletons"></a>
Displaying Multiple Skeletons</h1>
<ol>
<li>
Create a new script and name it <em>SkeletonController</em>. In this script, we'll define how to track and display multiple skeletons. </li>
<li>
<p class="startli">Add the <em>nuitrack</em> namespace. Create the <em>SkeletonCount</em> public variable and set the range from 0 to 6 (the number of tracked skeletons). Create the <em>SimpleSkeletonAvatar</em> field (for the <b>SkeletonAvatar</b> model that we've created). Create a list of <em>SkeletonAvatars</em> (displayed skeletons).</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> nuitrack;</div>
<div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SkeletonController : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    [Range(0, 6)]</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> skeletonCount = 6;         </div>
<div class="line">    [SerializeField] SimpleSkeletonAvatar skeletonAvatar;</div>
<div class="line"> </div>
<div class="line">    List&lt;SimpleSkeletonAvatar&gt; avatars = <span class="keyword">new</span> List&lt;SimpleSkeletonAvatar&gt;();</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>We set the range from 0 to 6 because Nuitrack tracks up to 6 skeletons.</dd></dl>
</li>
<li>
<p class="startli">In <em>Start</em>, spawn skeletons on the scene, get the <em>SimpleSkeletonAvatar</em> component from each skeleton, and set <em>autoProcessing</em> to <em>false</em> (because we want to process several skeletons). Add a skeleton to the list of avatars <em>avatars.Add(simpleSkeleton)</em>. Pass the desired number of tracked skeletons to Nuitrack. You can set the desired number of skeletons in the Unity editor.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SkeletonController : MonoBehaviour</div>
<div class="line">{    </div>
<div class="line">...</div>
<div class="line">    <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; skeletonCount; i++)</div>
<div class="line">        {</div>
<div class="line">            GameObject newAvatar = Instantiate(skeletonAvatar.gameObject, transform, <span class="keyword">true</span>);</div>
<div class="line">            SimpleSkeletonAvatar simpleSkeleton =   newAvatar.GetComponent&lt;SimpleSkeletonAvatar&gt;();</div>
<div class="line">            simpleSkeleton.autoProcessing = <span class="keyword">false</span>;</div>
<div class="line">            avatars.Add(simpleSkeleton);</div>
<div class="line">        }</div>
<div class="line">        NuitrackManager.SkeletonTracker.SetNumActiveUsers(skeletonCount);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Create the <em>OnSkeletonUpdate</em> method, which accepts all the info about the received skeletons (<em>skeletonData</em>). Loop over all the spawned skeletons depending on the number of tracked skeletons specified in Unity. If there is a skeleton received from Nuitrack for a skeleton avatar, it's processed and displayed, otherwise, it's hidden.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SkeletonController : MonoBehaviour</div>
<div class="line">{    </div>
<div class="line">…</div>
<div class="line">    <span class="keywordtype">void</span> OnSkeletonUpdate(SkeletonData skeletonData)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; avatars.Count; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (i &lt; skeletonData.Skeletons.Length)</div>
<div class="line">            {</div>
<div class="line">                avatars[i].gameObject.SetActive(<span class="keyword">true</span>);</div>
<div class="line">                avatars[i].ProcessSkeleton(skeletonData.Skeletons[i]);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                avatars[i].gameObject.SetActive(<span class="keyword">false</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>OnEnable</em> method, subscribe to <em>OnSkeletonUpdateEvent</em>, which is called each time the skeleton is updated (each frame). Update the skeleton info.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SkeletonController : MonoBehaviour</div>
<div class="line">{    </div>
<div class="line">    …    </div>
<div class="line">    <span class="keywordtype">void</span> OnEnable()</div>
<div class="line">    {</div>
<div class="line">        NuitrackManager.SkeletonTracker.OnSkeletonUpdateEvent += OnSkeletonUpdate;</div>
<div class="line">    }</div>
<div class="line">    …</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
Save the <b>SimpleSkeletonAvatar</b> prefab and delete it from the scene. </li>
<li>
Add the <em>SkeletonController</em> script to <b>SkeletonsCanvas</b>. </li>
<li>
<p class="startli">Set the desired number of tracked skeletons with a slider.</p>
<div class="image">
<img src="Urgb_10.png" alt="Urgb_10.png"/>
</div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">Drag-and-drop the <b>Simple Skeleton Avatar</b> prefab to the <b>Skeleton Avatar</b> field of the <em>SkeletonController</em> script.</p>
<div class="image">
<img src="Urgb_11.jpg" alt="Urgb_11.jpg"/>
</div>
 <p class="endli"></p>
</li>
<li>
Run the project. Now the skeletons of several users are tracked and displayed on the RGB image. Congratulations! </li>
</ol>
<div class="image">
<img src="Urgb_1.gif" alt="Urgb_1.gif"/>
</div>
  </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="UnityTutorials_page.html">Unity Tutorials</a></li>
    <li class="footer">Generated on Thu Aug 22 2019 12:41:46 for Nuitrack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
