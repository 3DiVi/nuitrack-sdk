<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Nuitrack: Creating an Interactive Multi-Touch Gallery</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nuitrack.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nuitrack
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">3D Skeleton Tracking Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('UnityGallery_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Creating an Interactive Multi-Touch Gallery </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gallery_scene">Setting Up the Scene</a></li>
<li class="level1"><a href="#gallery_create">Creating a Gallery</a></li>
<li class="level1"><a href="#gallery_pages">Turning the Pages</a></li>
<li class="level1"><a href="#gallery_interaction">Adding Interaction with Gallery Elements and the "Click" event</a></li>
<li class="level1"><a href="#gallery_dragging">Dragging, zooming and rotating the Images in View Mode</a></li>
</ul>
</div>
<div class="textblock"><p>In this tutorial, you'll learn how to create a virtual gallery that can be controlled using gestures. The gallery will have two modes: preview (several images displayed on one page) and view (when you click on an image, it opens in full screen). The gallery can be controlled with one or two hands (multi-touch) and gestures "click", "swipe up", "swipe left", "swipe right". For this project, you'll need Nuitrack and a sensor (from the list of supported sensors, see the <a href="https://nuitrack.com/">Nuitrack website</a>).</p>
<p>To create this project, you'll need just a couple of things: </p>
<ul>
<li>
Nuitrack Runtime and Nuitrack SDK </li>
<li>
Any supported sensor (see the complete list at <a href="https://nuitrack.com/">Nuitrack website</a>) </li>
<li>
Unity 2017.4 or higher </li>
</ul>
<p>You can find the finished project in <b>Nuitrack SDK</b>: <b>Unity 3D → NuitrackSDK.unitypackage → Tutorials → HandTracker</b></p>
<div class="image">
<img src="Ugallery_15.gif" alt="Ugallery_15.gif"/>
</div>
 <h1><a class="anchor" id="gallery_scene"></a>
Setting Up the Scene</h1>
<ol>
<li>
<p class="startli">Drag-and-drop the <b>Nuitrack Scripts</b> prefab from the <b>Nuitrack SDK</b> and tick the required modules in the <b>Nuitrack Manager</b> section: <b>Skeleton Tracker Module</b> (tracking of a user), <b>Hands Tracker Module</b> (detecting user's hands), <b>Gestures Recognizer Module</b> (gesture recognition).</p>
<div class="image">
<img src="Ugallery_1.png" alt="Ugallery_1.png"/>
<div class="caption">
Required Nuitrack modules for this project</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">Create a new script <em>Pointer.cs</em>. It will store the settings of a pointer that is used to control the gallery. In the <em>Start</em> method, subscribe to the <em>onHandsTrackerUpdate</em> event to receive data on the state of user's hands.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> Start()</div>
<div class="line">{    </div>
<div class="line">    NuitrackManager.onHandsTrackerUpdate += NuitrackManager_onHandsTrackerUpdate;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Unsubscribe from this event in the <em>OnDestroy</em> method in order to prevent issues with null references when switching to another scene.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> OnDestroy()</div>
<div class="line">{</div>
<div class="line">    NuitrackManager.onHandsTrackerUpdate -= NuitrackManager_onHandsTrackerUpdate;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>NuitrackManager_onHandsTrackerUpdate</em> method, check whether the left or the right hand is used for control. Add the processing of data on user's hands to move the corresponding pointer. Define that the "click" event occurs when a user clenches his hand into a fist. If a hand is inactive, it is hidden.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> NuitrackManager_onHandsTrackerUpdate(nuitrack.HandTrackerDatahandTrackerData)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> active = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> press = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> (nuitrack.UserHands userHands in handTrackerData.UsersHands) </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (currentHand == Hands.right &amp;&amp; userHands.RightHand != null)</div>
<div class="line">        {</div>
<div class="line">            baseRect.anchoredPosition = <span class="keyword">new</span> Vector2(userHands.RightHand.Value.X * Screen.width, -userHands.RightHand.Value.Y * Screen.height);</div>
<div class="line">            active = <span class="keyword">true</span>;</div>
<div class="line">            press = userHands.RightHand.Value.Click;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentHand == Hands.left &amp;&amp; userHands.LeftHand != null)</div>
<div class="line">        {</div>
<div class="line">            baseRect.anchoredPosition = <span class="keyword">new</span> Vector2(userHands.LeftHand.Value.X * Screen.width, -userHands.LeftHand.Value.Y * Screen.height);</div>
<div class="line">            active = <span class="keyword">true</span>;</div>
<div class="line">            press = userHands.LeftHand.Value.Click;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>Pointer.cs</em> script, add fields for hands and <em>RectTransform</em>, as well as for the background, default sprite and "click" sprite.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</div>
<div class="line"><span class="keyword">using</span> UnityEngine.UI;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Pointer : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> Hands { left = 0, right = 1 };</div>
<div class="line">     </div>
<div class="line">    [SerializeField]</div>
<div class="line">    Hands currentHand;</div>
<div class="line">     </div>
<div class="line">    [Header (<span class="stringliteral">&quot;Visualization&quot;</span>)]</div>
<div class="line">    [SerializeField]</div>
<div class="line">    RectTransform baseRect;</div>
<div class="line"></div>
<div class="line">    [SerializeField]</div>
<div class="line">    Image background;</div>
<div class="line">     </div>
<div class="line">    [SerializeField]</div>
<div class="line">    Sprite defaultSprite;</div>
<div class="line">     </div>
<div class="line">    [SerializeField]</div>
<div class="line">    Sprite pressSprite;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Depending on the state of a hand, the pointer will be either displayed or hidden. To visualize the clenched hand, let's use the "click" sprite and replace this in the <b>Image</b> component.</p>
<div class="fragment"><div class="line">background.enabled = active;</div>
<div class="line">background.sprite = active &amp;&amp; press ? pressSprite : defaultSprite;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Learn more about ?: operator at the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/conditional-operator">Microsoft website</a>.</dd></dl>
</li>
<li>
<p class="startli">In Unity, create a <b>Canvas</b> to display our gallery. In the <b>Canvas</b>, create the <b>RHand</b> and <b>LHand</b> Images to display the pointers: <b>UI → Image</b>. Set up the <b>Camera</b>: in the <b>Canvas</b>, select <b>Render Mode → Screen Space Camera</b>; <b>Render Camera → Main Camera</b>.</p>
<div class="image">
<img src="Ugallery_2.png" alt="Ugallery_2.png"/>
<div class="caption">
Canvas settings</div></div>
 <p class="endli"></p>
</li>
<li>
Drag-and-drop the <em>Pointer.cs</em> script to the <b>LHand</b> and <b>RHand</b> Images. </li>
<li>
<p class="startli">Drag-and-drop the <b>Image</b> (sprite used to visualize a hand) to <b>RHand</b> and <b>LHand</b>. Set the following settings: <b>Rect Transform → Top Left Alignment</b> so that that the origin of coordinates of the pointer is in the upper left corner.</p>
<div class="image">
<img src="Ugallery_3.png" alt="Ugallery_3.png"/>
<div class="caption">
LHand and RHand settings </div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">In Unity, specify the settings of a right hand: <b>Current Hand → Right</b>, make a reference to <b>BaseRect</b>. For a left hand, do the same thing. Create a reference to the <b>Image</b> component: <b>Background → Image</b>. Set the sprite for the "press" pointer: <b>Press Sprite → HandDown</b>.</p>
<div class="image">
<img src="Ugallery_4.png" alt="Ugallery_4.png"/>
<div class="caption">
Pointer settings</div></div>
 <p class="endli"></p>
</li>
<li>
Run the project. The pointers should be displayed and move according to the user's movements. Also, the "press" sprite should appear when the user clenches his hand. </li>
</ol>
<div class="image">
<img src="Ugallery_5.gif" alt="Ugallery_5.gif"/>
<div class="caption">
Moving pointers</div></div>
 <h1><a class="anchor" id="gallery_create"></a>
Creating a Gallery</h1>
<ol>
<li>
<p class="startli">In Unity, add an object for scrolling the content in our gallery to the <b>Canvas</b>: <b>GameObject → ScrollView</b>. Edit the <b>ScollView</b> settings: in the <b>Scroll Rect</b>, untick <b>Vertical</b>. For the <b>Scroll Rect</b>, set the alignment along the edges so that it's stretched up to the <b>Canvas</b> edges (even if you resize the screen, it will fill up the entire screen).</p>
<div class="image">
<img src="Ugallery_6.png" alt="Ugallery_6.png"/>
<div class="caption">
Scroll View settings</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">For the <b>Content</b>, set the Top Left alignment so that it does not move to the side and the origin of coordinates is at the top left of the <b>ScrollRect</b>.</p>
<div class="image">
<img src="Ugallery_7.png" alt="Ugallery_7.png"/>
<div class="caption">
Content settings</div></div>
 <dl class="section note"><dt>Note</dt><dd>We disable <b>Vertical</b> in our project because we would like to scroll our gallery only horizontally. However, you can create a gallery with a vertical scroll or a vertical and horizontal scroll, if you'd like to.</dd></dl>
</li>
<li>
<p class="startli">Create a new script <em>GalleryControl.cs</em>. In this script, we'll define the settings and types of control for our gallery. Add the fields for the image display mode, control elements and additional configuration settings of our gallery. The gallery supports two modes: previewing and viewing images.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>GalleryControl : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">enum</span> ViewMode { Preview, View };</div>
<div class="line">    ViewMode currentViewMode = ViewMode.Preview;</div>
<div class="line">     </div>
<div class="line">    [Header(<span class="stringliteral">&quot;Visualization&quot;</span>)]</div>
<div class="line">     </div>
<div class="line">    [SerializeField] ScrollRect scrollRect;</div>
<div class="line">    [SerializeField] Sprite[] spriteCollection;</div>
<div class="line">    [SerializeField] RectTransform content;</div>
<div class="line">    [SerializeField] GameObject imageItemPrefab;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Set the number of columns and rows displayed on a page in the gallery view mode (you can set any positive numbers that you want). Set the variables to store a page size, number of pages and size of an image in the preview mode.</p>
<div class="fragment"><div class="line">[Range(1, 10)]</div>
<div class="line">[SerializeField] <span class="keywordtype">int</span> rowsNumber = 3;</div>
<div class="line">[Range(1, 10)]</div>
<div class="line">[SerializeField] <span class="keywordtype">int</span> colsNumber = 4;</div>
<div class="line"></div>
<div class="line">Vector2 pageSize;</div>
<div class="line"><span class="keywordtype">int</span> numberOfPages = 0;</div>
<div class="line"></div>
<div class="line">Vector2 defaultSize;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>Start</em> method, fill the gallery with pictures.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Start()</div>
<div class="line">{</div>
<div class="line">    pageSize = <span class="keyword">new</span> Vector2(Screen.width, Screen.height);</div>
<div class="line">    defaultSize = <span class="keyword">new</span> Vector2(Screen.width / colsNumber, Screen.height / rowsNumber); <span class="comment">// calculate the size of an image in the preview mode</span></div>
<div class="line"></div>
<div class="line">    Vector2 halfAdd = <span class="keyword">new</span> Vector2(defaultSize.x / 2, -defaultSize.y / 2); </div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> imagesOnPage = rowsNumber * colsNumber;</div>
<div class="line">    numberOfPages = (int)Mathf.Ceil((<span class="keywordtype">float</span>)spriteCollection.Length / imagesOnPage); <span class="comment">// divide the total number of pictures by the number of pictures on one page and round it up</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> imageIndex = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; numberOfPages; p++) <span class="comment">// iterate over the pages</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> imagesOnCurrentPage = Mathf.Min(spriteCollection.Length - p * imagesOnPage, imagesOnPage); <span class="comment">// set the number of images on a current page</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; imagesOnCurrentPage; i++) <span class="comment">// fill the current page with images</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Create an image object from the prefab and make it child to the content</span></div>
<div class="line">            GameObject currentItem = Instantiate(imageItemPrefab);</div>
<div class="line">            currentItem.transform.SetParent(content.transform, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Calculate and specify the position on the content</span></div>
<div class="line">            RectTransform currentRect = currentItem.GetComponent&lt;RectTransform&gt;();</div>
<div class="line">            currentRect.sizeDelta = defaultSize;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> X = pageSize.x * p + defaultSize.x * (i % colsNumber);</div>
<div class="line">            <span class="keywordtype">float</span> Y = defaultSize.y * (i / colsNumber);</div>
<div class="line"></div>
<div class="line">            currentRect.anchoredPosition = <span class="keyword">new</span> Vector2(X, -Y) + halfAdd;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Drag-and-drop to the sprite</span></div>
<div class="line">            Image currentImage = currentItem.GetComponent&lt;Image&gt;();</div>
<div class="line">            currentImage.sprite = spriteCollection[imageIndex];</div>
<div class="line">            imageIndex++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    content.sizeDelta = <span class="keyword">new</span> Vector2(Screen.width * numberOfPages, Screen.height); <span class="comment">// set the content size</span></div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In Unity, drag-and-drop the <em>GalleryControl.cs</em> script to the <b>Canvas</b>. Drag-and-drop: <b>Scroll Rect → Scroll View</b>, <b>Content → Content</b>. Create an <b>Image</b> object for an image: <b>Content → GameObject → UI → Image</b>. Create a prefab and drag-and-drop the <b>Image</b> object to this prefab. Drag-and-drop this prefab to <b>GalleryControl</b> (<b>Gallery Control → Image Item Prefab</b>). In the <b>GalleryControl</b> settings, set the desired number of columns and rows with images.</p>
<div class="image">
<img src="Ugallery_8.png" alt="Ugallery_8.png"/>
<div class="caption">
Gallery Control settings</div></div>
 <dl class="section note"><dt>Note</dt><dd>The gif below shows a quick way to fill your gallery with images: </dd></dl>
</li>
</ol>
<div class="image">
<img src="Ugallery_9.gif" alt="Ugallery_9.gif"/>
<div class="caption">
Fill your gallery with images in seconds! </div></div>
 <h1><a class="anchor" id="gallery_pages"></a>
Turning the Pages</h1>
<ol>
<li>
<p class="startli">To add the function of turning the pages to our gallery, add the fields with the values that define the speed of turning the page, offset step for the <em>ScrollRect</em> element and the current page number.</p>
<div class="fragment"><div class="line">[Header(<span class="stringliteral">&quot;Scroll&quot;</span>)]</div>
<div class="line"> </div>
<div class="line">[Range(0.1f, 10)]</div>
<div class="line">[SerializeField] <span class="keywordtype">float</span> scrollSpeed = 4f;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> scrollStep = 0;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> currentPage = 0;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>GalleryControl.cs</em> script in the <em>Start</em> method, subscribe the <em>NuitrackManager_onNewGesture</em> method to the <em>onNewGesture</em> event of the <b>NuitrackManager</b> component to receive events of gestures. Unsubscribe from this event in the <em>OnDestroy</em> method.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Start()</div>
<div class="line">{</div>
<div class="line">    NuitrackManager.onNewGesture += NuitrackManager_onNewGesture;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> OnDestroy()</div>
<div class="line">    {</div>
<div class="line">        NuitrackManager.onNewGesture -= NuitrackManager_onNewGesture;</div>
<div class="line">    }</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Calculate the scrolling step in the <em>Start</em> method.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (numberOfPages &gt; 1)</div>
<div class="line">    scrollStep = 1f / (numberOfPages - 1); <span class="comment">// 1/(n-1) given that the Scrollbar takes values from 0 to 1 and one page is already displayed</span></div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">First, check the gallery mode (View, Preview) in the <em>NuitrackManager_onNewGesture</em> method, then define the gesture type and, depending on the result, increment or decrement the number of the current page. To ensure that the page number is not out of range, let's set the value in the range from 0 to the total number of pages in the <em>Mathf.Clamp</em> function.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> NuitrackManager_onNewGesture(nuitrack.Gesture gesture)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (currentViewMode)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> ViewMode.Preview:</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (gesture.Type == nuitrack.GestureType.GestureSwipeLeft)</div>
<div class="line">            currentPage = Mathf.Clamp(++currentPage, 0, numberOfPages);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (gesture.Type == nuitrack.GestureType.GestureSwipeRight)</div>
<div class="line">            currentPage = Mathf.Clamp(--currentPage, 0, numberOfPages);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><b>Nuitrack</b> supports the following types of gestures: Waving, Push, Swipe Up, Swipe Down, Swipe Left, Swipe Right.</dd></dl>
</li>
<li>
<p class="startli">In the <em>Update</em> method, add smooth turning of pages to the current page.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> Update()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> ViewMode.Preview:</div>
<div class="line">        scrollRect.horizontalScrollbar.value = Mathf.Lerp(scrollRect.horizontalScrollbar.value, scrollStep * currentPage, Time.deltaTime * scrollSpeed); <span class="comment">// move the content until the current page is displayed </span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
Run the project. You should see a gallery with images that can be scrolled to the left or to the right. </li>
</ol>
<div class="image">
<img src="Ugallery_10.gif" alt="Ugallery_10.gif"/>
<div class="caption">
Scrolling the gallery</div></div>
 <h1><a class="anchor" id="gallery_interaction"></a>
Adding Interaction with Gallery Elements and the "Click" event</h1>
<ol>
<li>
Create a new script <em>ImageItem.cs</em>. In this script, we'll describe the interaction with images in our gallery. Inherit it not from the <em>MonoBehaviour</em> class but from the <a href="https://docs.unity3d.com/ScriptReference/UI.Selectable.html"><em>Selectable</em></a> class so that it conforms to the general rules of interaction with the UI system in Unity. </li>
<li>
<p class="startli">In Unity, drag-and-drop this script to the <b>ImageItem</b>, set the lighting of images in the gallery depending on the pointer position.</p>
<div class="image">
<img src="Ugallery_11.png" alt="Ugallery_11.png"/>
<div class="caption">
Lighting settings</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">To interact with elements in the UI, we need to know, which element the user points to. If you use the mouse pointer, the process is performed using the built-in Unity components <a href="https://docs.unity3d.com/Manual/script-StandaloneInputModule.html">Standalone Input Module</a>, <a href="https://docs.unity3d.com/ScriptReference/EventSystems.EventSystem.html"><em>EventSystem</em></a> and <a href="https://docs.unity3d.com/Manual/script-GraphicRaycaster.html">Graphic Raycaster</a>. In our case, we use our custom pointers, and we have to determine their logic of interaction. Similarly to the mouse pointer, to get the interface element that is located under our pointer, we use <em>RayCast</em> for the UI system that "penetrates" the <b>Canvas</b> and all the elements and returns a list of all the "penetrated" items.</p>
<p>To implement <em>RayCast</em>, we need a camera from which we will throw a beam, a variable storing the current element, a variable storing the data on the point (<a href="https://docs.unity3d.com/ScriptReference/EventSystems.PointerEventData.html"><em>PointerEventData</em></a>) selected by the user, and a list of elements acting as a temporary results storage <em>RayCast</em>.</p>
<div class="fragment"><div class="line">[Header(<span class="stringliteral">&quot;Raycasting&quot;</span>)]</div>
<div class="line"> </div>
<div class="line">[SerializeField]</div>
<div class="line">Camera cam;</div>
<div class="line"> </div>
<div class="line">ImageItem selectedButton;</div>
<div class="line"> </div>
<div class="line">PointerEventData eventData = <span class="keyword">new</span> PointerEventData(null);</div>
<div class="line">List&lt;RaycastResult&gt; raycastResults = <span class="keyword">new</span> List&lt;RaycastResult&gt;();</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">If the pointer is active, we can determine which element the user is pointing to. First, define the point at which the ray will be thrown. Then project the position of the pointer relative to the screen: to do this, call the <em>WorldToScreenPoint</em> camera method. Also, define the pointer offset, which we will need later. Clear the <em>RayCast</em> list of elements from the previous frame and perform raycasting using <em>RaycastAll</em>. Then iterate the list in a loop to find the element with the <em>ImageItem</em> component for interaction.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!active)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">Vector2 pointOnScreenPosition = cam.WorldToScreenPoint(transform.position);</div>
<div class="line">eventData.delta = pointOnScreenPosition - eventData.position;</div>
<div class="line">eventData.position = pointOnScreenPosition;</div>
<div class="line"> </div>
<div class="line">raycastResults.Clear(); <span class="comment">// clear the raycasting results from the previous frame </span></div>
<div class="line"></div>
<div class="line">EventSystem.current.RaycastAll(eventData, raycastResults);</div>
<div class="line"> </div>
<div class="line">ImageItem newButton = null;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> q = 0; q &lt; raycastResults.Count &amp;&amp; newButton == null; q++)</div>
<div class="line">      newButton = raycastResults[q].gameObject.GetComponent&lt;ImageItem&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (newButton != selectedButton)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (selectedButton != null)</div>
<div class="line">        selectedButton.OnPointerExit(eventData);</div>
<div class="line"> </div>
<div class="line">        selectedButton= newButton;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (selectedButton != null)</div>
<div class="line">        selectedButton.OnPointerEnter(eventData);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In Unity, set the camera that will be used in <b>Pointer</b> for raycasting: <b>RHand и LHand → Pointer → Raycasting → Cam → Main Cam</b>.</p>
<div class="image">
<img src="Ugallery_12.png" alt="Ugallery_12.png"/>
<div class="caption">
Raycasting settings</div></div>
 <p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>Pointer.cs</em> script, add the "press / release" event handling. The "click" event will be performed if the user's hand moves at a speed lower than the one specified in <em>dragSensitivity</em>. This is necessary to get rid of "phantom" clicks when the user actively moves his hand.</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (selectedButton != null)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (press)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (eventData.delta.sqrMagnitude &lt; dragSensitivity)</div>
<div class="line">        {</div>
<div class="line">            eventData.dragging = <span class="keyword">true</span>;</div>
<div class="line">            selectedButton.OnPointerDown(eventData);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eventData.dragging)</div>
<div class="line">    {</div>
<div class="line">        eventData.dragging = <span class="keyword">false</span>;</div>
<div class="line">        selectedButton.OnPointerUp(eventData);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>ImageItem.cs</em> script, define the "click" event.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ImageItem : Selectable</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> delegate <span class="keywordtype">void</span> Click(ImageItem currentItem);</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">event</span> Click OnClick;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Override the <em>OnPointerUp</em> method: when the hand is released, the click will be counted.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPointerUp(PointerEventData eventData)</div>
<div class="line">{</div>
<div class="line">    OnClick(<span class="keyword">this</span>);</div>
<div class="line">    InstantClearState();</div>
<div class="line"> </div>
<div class="line">    base.OnPointerUp(eventData);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>GalleryControl.cs</em> script in the <em>Start</em> method, add a field for <em>canvasGroup</em>, and also define the parameters for full-screen image view.</p>
<div class="fragment"><div class="line">[SerializeField] CanvasGroup canvasGroup;</div>
<div class="line"></div>
<div class="line">[Header(<span class="stringliteral">&quot;View&quot;</span>)]</div>
<div class="line">[SerializeField] RectTransform viewRect;</div>
<div class="line"></div>
<div class="line">Vector2 defaultPosition;</div>
<div class="line"> </div>
<div class="line">[Range(0.1f, 16f)]</div>
<div class="line">[SerializeField] <span class="keywordtype">float</span> animationSpeed = 2;</div>
<div class="line"> </div>
<div class="line">ImageItem selectedItem = null;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> animated = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">float</span> t = 0; <span class="comment">// current animation time</span></div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Subscribe to the "click" event.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; imagesOnCurrentPage.Length; i++)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">    currentImage.sprite = spriteCollection[imageIndex];</div>
<div class="line">    imageIndex++;</div>
<div class="line"></div>
<div class="line">    ImageItem currentImageItem = currentItem.GetComponent&lt;ImageItem&gt;();</div>
<div class="line">    currentImageItem.OnClick += CurrentImageItem_OnClick;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Add the mode check: from the preview mode, the switching to the view mode is performed. If a user clicks on the picture, the picture is thrown to the <em>viewRect</em>, so that it does not fade like the other pictures on the content (in <b>Scroll Rect</b>). Using the <a href="https://docs.unity3d.com/Manual/class-CanvasGroup.html"><em>canvasGroup.interactable</em></a> variable, disable interactivity of all pictures left from the content (the actions of the <em>canvasGroup</em> script are applied to all its children, that is, when we disable its interactivity, then interactivity is disabled for all its children, too).</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> CurrentImageItem_OnClick(ImageItem currentItem)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (currentViewMode == ViewMode.Preview)</div>
<div class="line">    {</div>
<div class="line">        t = 0;</div>
<div class="line">        currentViewMode = ViewMode.View;</div>
<div class="line">        selectedItem = currentItem;</div>
<div class="line"></div>
<div class="line">        canvasGroup.interactable = <span class="keyword">false</span>;</div>
<div class="line">        selectedItem.interactable = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        selectedItem.transform.SetParent(viewRect, <span class="keyword">true</span>);</div>
<div class="line">        defaultPosition = selectedItem.transform.localPosition;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>Update</em> method, determine the characteristics of the animation in the gallery: when you click and switch to the view mode, the image opens in full screen.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> Update()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (currentViewMode)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> ViewMode.View:</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (t &lt; 1)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Add the delta multiplied by the specified speed to the current animation time</span></div>
<div class="line">                t += Time.deltaTime * animationSpeed;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Shift the transparency of the remaining pictures to 0 exponentially from t</span></div>
<div class="line">                canvasGroup.alpha = Mathf.Lerp(canvasGroup.alpha, 0, t);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Stretch the picture to the full screen size exponentially from t</span></div>
<div class="line">                selectedItem.image.rectTransform.sizeDelta = Vector2.Lerp(selectedItem.image.rectTransform.sizeDelta, pageSize, t);</div>
<div class="line">                <span class="comment">// Move the picture to the center of the screen exponentially from t</span></div>
<div class="line">                selectedItem.transform.localPosition = Vector2.Lerp(selectedItem.transform.localPosition, Vector2.zero, t);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    ...</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Add the animation in case the "preview" mode is selected.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">case ViewMode.Preview:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (animated)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (t &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Roll back the time from 1 to 0</span></div>
<div class="line">            t -= Time.deltaTime * animationSpeed;</div>
<div class="line"></div>
<div class="line">            canvasGroup.alpha = Mathf.Lerp(1, canvasGroup.alpha, t);</div>
<div class="line"></div>
<div class="line">            selectedItem.image.rectTransform.sizeDelta = Vector2.Lerp(defaultSize, selectedItem.image.rectTransform.sizeDelta, t);</div>
<div class="line"></div>
<div class="line">            selectedItem.transform.localPosition = Vector2.Lerp(defaultPosition, selectedItem.transform.localPosition, t);</div>
<div class="line">            selectedItem.transform.localRotation = Quaternion.Lerp(Quaternion.identity, selectedItem.transform.localRotation, t);</div>
<div class="line">            selectedItem.transform.localScale = Vector3.Lerp(Vector3.one, selectedItem.transform.localScale, t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Make the image a child of the content</span></div>
<div class="line">            selectedItem.transform.SetParent(content, <span class="keyword">true</span>);</div>
<div class="line">            <span class="comment">// Return interactivity to all elements</span></div>
<div class="line">            selectedItem.interactable = <span class="keyword">true</span>;</div>
<div class="line">            canvasGroup.interactable = <span class="keyword">true</span>;</div>
<div class="line">            <span class="comment">// Discard the selected image and stop the animation</span></div>
<div class="line">            selectedItem = null;</div>
<div class="line">            animated = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        scrollRect.horizontalScrollbar.value = Mathf.Lerp(scrollRect.horizontalScrollbar.value, scrollStep * currentPage, Time.deltaTime * scrollSpeed);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Add the actions to be performed when exiting the view mode.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> NuitrackManager_onNewGesture(nuitrack.Gesture gesture)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> ViewMode.View:</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If there was a swipe up, then switch to the preview mode and start the animation</span></div>
<div class="line">        <span class="keywordflow">if</span> (gesture.Type == nuitrack.GestureType.GestureSwipeUp)</div>
<div class="line">        {</div>
<div class="line">            currentViewMode = ViewMode.Preview;</div>
<div class="line">            animated = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
In Unity, add the <b>Canvas Group</b> component, which we need to make the background transparent when the image opens in the view mode: <b>Unity → Scroll View → Add Component → Canvas Group</b>. In the <b>Canvas</b>, set black as the background color (to make our gallery even more beautiful). Add the <b>Panel</b> object to the Canvas so that we have an empty rectangle, in which we will put the picture in the view mode: <b>Canvas → GameObject → UI → Panel</b> and delete the <b>Image</b> component. To correctly display the gallery and pointers, <b>Canvas</b> should have the following hierarchy: <ul>
<li>
Scroll View </li>
<li>
View </li>
<li>
RHand </li>
<li>
LHand </li>
</ul>
</li>
<li>
<p class="startli">Drag-and-drop the area that will contain an image in the view mode to the Canvas: <b>Gallery Control → View Rect → View (Rect Transform)</b>.</p>
<div class="image">
<img src="Ugallery_13.png" alt="Ugallery_13.png"/>
<div class="caption">
Setting the View Rect</div></div>
 <p class="endli"></p>
</li>
<li>
Run the project. Images will now change color depending on the cursor position. After the click, the image will open in the view mode. You can close the image with a swipe up. </li>
</ol>
<div class="image">
<img src="Ugallery_14.gif" alt="Ugallery_14.gif"/>
<div class="caption">
Interactive gallery </div></div>
 <h1><a class="anchor" id="gallery_dragging"></a>
Dragging, zooming and rotating the Images in View Mode</h1>
<ol>
<li>
<p class="startli">In the <em>ImagItem.cs</em> script, add the handling for One-Touch and Multi-Touch events. Add fields for storing current touches, initial position, rotation, and the image scale.</p>
<div class="fragment"><div class="line">List&lt;PointerEventData&gt; touches = <span class="keyword">new</span> List&lt;PointerEventData&gt;();</div>
<div class="line"></div>
<div class="line">Vector3 startCenter;</div>
<div class="line">Vector3 startPosition;</div>
<div class="line"></div>
<div class="line">Vector3 startScale;</div>
<div class="line"><span class="keywordtype">float</span> startHandDistance;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> startAngle;</div>
<div class="line">Quaternion startRotation;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Override the <em>OnPointerExit</em> method: if the hand is outside the picture, then the touch is canceled.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPointerExit(PointerEventData eventData)</div>
<div class="line">{</div>
<div class="line">    touches.Remove(eventData);</div>
<div class="line">    base.OnPointerExit(eventData);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Since the change in the image state will be calculated based on the changes made since the start of capture until the current moment, determine the method for saving the initial image state.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> UpdateInitialState()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (OneTouch)</div>
<div class="line">    {</div>
<div class="line">        startCenter = touches[0].position;  </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (MultiTouch)</div>
<div class="line">    {</div>
<div class="line">        startCenter = (touches[0].position + touches[1].position) / 2;</div>
<div class="line">        startHandDistance = (touches[0].position - touches[1].position).magnitude;</div>
<div class="line"></div>
<div class="line">        Vector3 pointRelativeToZero = touches[1].position - touches[0].position;</div>
<div class="line">        startAngle = Mathf.Atan2(pointRelativeToZero.x, pointRelativeToZero.y) * Mathf.Rad2Deg;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    startScale = transform.localScale;</div>
<div class="line">    startPosition = transform.localPosition;</div>
<div class="line">    startRotation = transform.localRotation;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Override the <em>OnPointerDown</em> method: if the hand is pressed, then the touch is added.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPointerDown(PointerEventData eventData)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!touches.Contains(eventData))</div>
<div class="line">    {</div>
<div class="line">        touches.Add(eventData);</div>
<div class="line">        UpdateInitialState();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    base.OnPointerDown(eventData);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Override the <em>OnPointerUp</em> method: when the hand is unclenched, the image is no longer held.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPointerUp(PointerEventData eventData)</div>
<div class="line">{</div>
<div class="line">    touches.Remove(eventData);</div>
<div class="line">    UpdateInitialState();</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Add support for the <a href="https://docs.unity3d.com/ScriptReference/EventSystems.IDragHandler.html"><em>IDragHandler</em></a> interface for handling drag-and-drop.</p>
<dl class="section note"><dt>Note</dt><dd>In this project, you can move images not only with hands, but also with the mouse pointer.</dd></dl>
</li>
<li>
<p class="startli">Define the <em>OnDrag</em> method: it will perform dragging, scaling and rotating of an image. For one pointer, only drag-and-drop is available. For two pointers, all actions are available.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> OnDrag(PointerEventData eventData)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (interactable || !eventData.dragging)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(OneTouch)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Take the initial saved position and add the offset from that moment</span></div>
<div class="line">        Vector3 currentCenter = touches[0].position;</div>
<div class="line">        transform.localPosition = startPosition + (currentCenter - startCenter);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(MultiTouch)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Calculate the center between two hands and add the center offset from start of capture</span></div>
<div class="line">        Vector3 currentCenter = (touches[0].position + touches[1].position) / 2;</div>
<div class="line">        transform.localPosition = startPosition + (currentCenter - startCenter);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Calculate the change in distance between two hands</span></div>
<div class="line">        <span class="keywordtype">float</span> currentHandDistance = (touches[0].position - touches[1].position).magnitude;</div>
<div class="line">        transform.localScale = startScale * Mathf.Abs(currentHandDistance / startHandDistance);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Calculate the angle of one hand relative to the other</span></div>
<div class="line">        Vector3 pointRelativeToZero = touches[1].position - touches[0].position;</div>
<div class="line">        <span class="keywordtype">float</span> angle = Mathf.Atan2(pointRelativeToZero.x, pointRelativeToZero.y) * Mathf.Rad2Deg;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Apply rotation </span></div>
<div class="line">        transform.localRotation = startRotation * Quaternion.Euler(0, 0, startAngle - angle);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">In the <em>Pointer.cs</em> script, add calling the <em>OnDrag</em> method of the current element to perform drag-and-drop.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (press)</div>
<div class="line">    selectedButton.OnDrag(eventData);</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Run the project. The image in the preview mode can be dragged with one or two hands, scaled and rotated with two hands.</p>
<div class="image">
<img src="Ugallery_15.gif" alt="Ugallery_15.gif"/>
<div class="caption">
The owl is coming!</div></div>
 <p class="endli">Congratulations, you've just created a gallery with images that you can control with gestures! </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="UnityTutorials_page.html">Unity Tutorials</a></li>
    <li class="footer">Generated on Thu Aug 22 2019 12:41:45 for Nuitrack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
